<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="沐云白">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2024/10/26/gas-learn2/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="第二季的c++内容更多，代码更扎实，也会注重更多细节，有关联机部分。 0 基础知识事件 强调执行的时机，调用时只是触发而不会等待，执行在不同的线程。 不可使用局部变量，无返回值，可跨蓝图访问。 函数 强调执行的逻辑，调用会等待函数执行结果，执行在同一个线程中。 可以使用局部变量，有返回值，可跨蓝图访问。 宏 可以有多个输入输出，所以适用于类似if、switch这样的流控制，如flipflop函数就">
<meta property="og:type" content="article">
<meta property="og:title" content="GAS学习记录第一季">
<meta property="og:url" content="http://example.com/2024/10/26/GAS-learn2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="第二季的c++内容更多，代码更扎实，也会注重更多细节，有关联机部分。 0 基础知识事件 强调执行的时机，调用时只是触发而不会等待，执行在不同的线程。 不可使用局部变量，无返回值，可跨蓝图访问。 函数 强调执行的逻辑，调用会等待函数执行结果，执行在同一个线程中。 可以使用局部变量，有返回值，可跨蓝图访问。 宏 可以有多个输入输出，所以适用于类似if、switch这样的流控制，如flipflop函数就">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MzdmZjI1YzVhYmY3M2VjODc1ZmNkY2ZiMGY1OTU2MmZfcExhMkNoRThRTkpERzByU1pQMFpjY3RKQjdmZ2t4TkJfVG9rZW46TlhrdWJGdGpOb0RKVmF4Q1JCcWNRTXR6bmRiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MmMyZjU1NmU2OGQyMDQxNTZjN2JjZjAzNmUwOTY2OGZfeURiVFhFcTdocENBd2ZOYWxBRWJRSm16amZWanVHZVhfVG9rZW46SW9remI1dEc0b0NSN1J4M3Vhc2NPTVBrbmplXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NGNkM2I5ZWZiZjI0ZTM1ZTI5NzczYmZjYmFjNmM5YjJfSHl6d1pZRmxQMGxYOUN4S0hRRXlLcWJBVzd0MVNBNExfVG9rZW46SWNRU2JJN0czb0lJbHZ4ZFpSc2M4YXpNbkpkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NjFiYzFjZTJiYTc4ZGRkM2I3NTg5MDYwNjA4ZWI3ZTZfVnVmMXFDZnJodjVIRmpGN0drRTJKTnlHMlQwVlY4WGJfVG9rZW46VExzRmJrMmlib3ZTTm14TXhENGNocGpIbmFmXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ODQxNTQxZjFiZjNlMzYyZTJkMWIyNWZhMGUzMzZiMGRfNFpGdVFmRElPaUZkSDgzR1RaRHVvd0NpZkRCWGFzaHpfVG9rZW46VGJrOGJ6R2x0b0UwR1h4dUlNbWM1SE12bkFmXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YzNiMzg3MzI2MTVjZjE4OTk2MWU0OWIwZDUyM2EyZDRfd21BcTI0STdJRms4RUNPS3YweXYyT3VBN01WMGFLTldfVG9rZW46SHRJS2J2bEN6b2NzTmt4VXRsN2NibG1ibmtnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MjdkMjFlYmQxZTNkYzM0YzQ5MmMyYmRiZDU2NjcyMjdfb0NEZmNlc09ZSW1sWmtEazE3OUNHeEt6MllBV3NwZWhfVG9rZW46WGREaGJQcjBtb2lvQ2R4bTk2eWNFNVp3bjRjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDRjY2UyZTlhN2Y2Y2JjOTE3NGU4OGVhOWQ3ZjY5ODVfY1dLbzhmcHNjVTFROW5QSmNzZ3RoemZaaEJQV3VpSmRfVG9rZW46SFF2Q2J4TFR6b3E4U1B4Nko4UGN2RXhBbmJlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDNlNmZkZDdjMWExNDdkNDA4NzM2ODAyN2YxZWMzNDBfU1JNb3NON1VvdDB3RXhhNlNoRHZWM3lqUjZsOEQ0ekZfVG9rZW46SGRCUWJsYkpwb3ZiY1l4YmtxSWNTZHpjbm9iXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MjI5ZmFhYzlkMGNlZWQyNmFkNGJkYmI4NzE1YzhkNmNfSDhsNTZrQ202dng4TjNCc1NTMUJhZG16TmF2YUZxclFfVG9rZW46QXllbGJ0a3hvb3Bpd1J4Wk4xVmNJS0o5bjNlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTg2NDE0NDdkNjg0ODdjOTMwMTk5NWIxMDU1MjVkM2Vfc2xqVlQybmV5bFJSS3pZVkxRbmk1R21oNkdJZGhYQW5fVG9rZW46Q0x5bmJJckFob2pYQ3V4WnJqZGNMUnlqbnhkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTFjODA2NzFkZmE3NjliZDYzMDYwOTY1NjFjNjY1ZDVfMldsZWhrWnZMSGpyeUh3YU1zZnhEdUJBOEhpVDhQcVVfVG9rZW46VTExN2IxanR2b3l1Qjl4Z3FETWNvYTdWbmFkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MzEwNGNkYjVjYzI3NzFkZTJkMGE5ODU3NzAxY2ViOTRfOVFIVmFXOVpVYUlaVHdoWVQ2SWV4R0FLVjNQR0tFdWtfVG9rZW46TzVXR2JDTlhVb01TQ2F4QUgydmNpMDZlbmpkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWVlNGVmNjU2YmE2ODlhMzFiN2FkNjg3MjBhN2ZiOWVfRXhpbWp6Y3BHTzhDbTJCUUZRaERjcVFoWnA0dzlMSlpfVG9rZW46SGI4N2I1djlRb1dPNGR4VWdQU2NuOHNxbndjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YjI1ZTRiMWIwZjJlYjQzMGQzZjY2M2IxODJjN2JkODhfdXFXUjFZUUExTHFzRzZIOGtmNUFYcldIMmh4cW1qaEFfVG9rZW46RGtGemJTMDB1b3ZHcHp4OWFLZ2NMVHV0blBkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTRkODYyNTEyYzUwNDdhZjBiMjhiZDY3N2JiMDMwNTFfeXMyVng2TDAwVXZBUVdYMkdTRnd6aURjeDFTdnRMeUlfVG9rZW46WDJZZmJtdW9Ub0R3clp4b3lKRGNLOTB3bmJnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ODUzOTlmM2JiZGIyMDVkNDQ4NGE1ZjFiOWU3NmI5YzdfZ2I1SUgxSVdqSjI2aFhpMVZKcDdNbTFiUEtzblNJcElfVG9rZW46T2pzUmJGZUxjb3p6S2Z4VnpWcGNwUVo0bnJnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Q0MTljMTVkYmFiN2U2NTA5NWU5ODY2YTZhNWIwNGFfZUU0VXFwTE9XbzZ4cjd1eEFkNEdGdTZoZnJrUmtEQk9fVG9rZW46TUR4RmJZU3oxb2lUVUd4NUdTRmNxSUNSbjVjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MmNiNmQwYjYzNDU0M2M3YWNhOTdkZjcyZGYzNDE3NWRfbjVhMlMzemRiZ1RXS3hLR05oNDhHVXByNkxpQUxNS0tfVG9rZW46RzdBR2JSaFY0b2xCRjZ4Tlo0RmNRVm9zbnZkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDNmNTJkNGY0M2U2MjdmMzQxMmQ2ZjkwMzgzNzdmMTFfQXRVQ2ZnZVkwajZqSjhFa3VFNkFTdmRDYnhES0tuZmdfVG9rZW46QWR3dWJnbWVJb0xsV3N4bENLU2N3ekJsbnhkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTVmM2RkYTgzMWFhZmI4YzM0YThkMTk2MzAxMzI3NDRfd3RXeXFRS0QySTBFQUYzb0VNaTYwSE9qalpwRDlLMXNfVG9rZW46RFlwVWJvT2Frb0lnZ3B4cFBNMGM1VmxsbkljXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDE3MTlkZGZhMzY2ZWI0MWY0MzA4NWFjZThjZjhkYjFfamFPbkpqNGhWc0ljNm5LU1htcWhqaUtMSWJoZGFRYkZfVG9rZW46WkVlbGJTQ0ZKb0tub0x4aVVoTGNpRTBNbmVlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YzgwMDdhMjdjMGU0ZTY4OTg5NzFlZGRhNzg2MzZmODZfUkxSY2IxNVFLbWJ5Tk1WWEpOejByTzBHMkFtYlo5T05fVG9rZW46TXlTMmI5Uzljb2k1MHB4b0RjVmNnVmJxbmZiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTc5ZDRmMWVhYmRkYmFjNTIyNmQyYmYxNjY5Zjk4YzRfZGVleW9NNngxaG5JVFgxVVZ6OFEyODNYSTFOM0FwQ1hfVG9rZW46QXZ2QWJESGoxbzhsRnJ4VUxnSWNzdkxObjdhXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=OTJkYWQ4OWJhOTk3YjAzZGNjMWQ4OTcwNWQxYmVmMjNfTlBnZ0VnbThuSEFoQnlKZHB6Mlk3M1dkWTgyS2I0NXRfVG9rZW46S0NQMmJJc1pYbzU5Nm14QnM3VmNxUmR3bkEzXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NDNhMjgyMzE1MmFmMzM0YWE0MzNiZDdhYTFiMjNlMWRfQnp6RjhkdUhvdGoxeUFPSFVRUDRZUG42eEpLSTRneHNfVG9rZW46UHg1aGJTcWF3b2g5MTd4V2pNemNaZ3ZObnBoXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NzQxN2M2MDRiYjc3NzM3MzIwYjEyYmVhYzZmYWM4MTlfck94UWNzb2toc3E1NnJMeVZBUnNtWGJFTzdsc0g4T1BfVG9rZW46SWgwaGJKc2dVb3VhR3B4YXRvZ2NjcDJGbnpoXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDhmNmJjM2YwZDYyZjE2ZmUyNDliN2I3NjdkNGEyZGFfa0VwTmZqc1ZNUDZDcEV2UExpSU4zazVnQnhwa1Q4czZfVG9rZW46WW1rb2JJNU9Ub1ZENVR4Mk1ma2NxWGlpbjRYXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=Nzg5YWRlMzVjZjE1MzBkZTY0Y2I4Y2VkODBmNjhhMWJfbk9Db3g4akM5UHJQSzEySVp3R05aVXlyd1RrZWdMeFFfVG9rZW46RlBQa2J6NEJ1bzR5Szh4MTAwcGNJY0x6bjhiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=OWJmYTgzMWRlODg5ZWEzYmUzNTUzOGQwMDBlMzA4OGZfV2JSNXdmaDNaQ0dZYUlYSVFNSGpnWXNhOUJHNUQzWThfVG9rZW46VU45SWIxWXRqb2M3TXh4Nzl1dWNERHllbjViXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDEwNWFhMzMzMzFlYmIzZmE2ZWUwZTIxMDU5NmRjZjZfZDlmZzVPZ2RmdGZqWFRyeHVlRUtPYUFVQ21TQ1BJMEhfVG9rZW46U3RwZ2JtSXoxb1NwcGZ4bGM3T2N4dnVabjRlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YmVlMDEzM2U5MDhhMzA5Mzg0MmEyN2QzNjBmNjRhMDlfVU1EWjNKU2tYWXhxeWF4aHdsbm1HOXNORVBWNUFlZ2pfVG9rZW46VzV2WWJSY0JTb3FWRUF4dXJYaWNHVmVwbkVoXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjFlYzJhOTk4YmMxZTIzYjYzZDRjMWZjYjkzOTEyNDFfTkx2ck5wWEFJM0M3U2g2WkRGc2plYWF6ZmtTOUVrMzFfVG9rZW46S0M2R2I2QTlmbzdNMUZ4bFdhYmNEUlE5bmlkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NDY5Y2ZmNDA3YjFmMjBhY2IzYTVlZWRhNTFhYjI1YzBfdG5PUFE5Tm9tZDhlZEwyajNSSnVMNWVuREFIc2ZlaFpfVG9rZW46U0wySWJsVHBrb21ma3Z4VFE3UGNZNGNhblNiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTU1NzZhOTk4MmM3OGRhZjI3NTc0YzA4N2VkZTIwZjRfWkc4Unk5cGRYTk1KM0s0VzNpQmdVS0E2VDVneEhNak1fVG9rZW46VnlvaWJjaTJSb0V2VmZ4cVNvcmNHV0pxbmRjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NjU4YmZmM2RmODJiYjI3NDE2ODIxNjI5MGIyYzE3ZjFfUUw1cm1lUExkdkZBUUczOENVNWN1aWxqak5EdHlPbDhfVG9rZW46R1Qza2JLcHhJb0tCOVp4T3pLcGMwU0IybmlmXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MjYyMWNmNTM2NWZhNDJlZmQ3ZjJjNTY3OGZkOGU3NzFfYnNtbXJOSGlrWVN4ZUMxeUQxNnZZQ3R4amFSbEpwN0FfVG9rZW46WEFUN2JxYnk3bzZqVkd4bEpHamM5aVJFbnZnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDAzYTNjNTQ0MjJjNGQ4MDE2YTllNjZkMmI3YTUxZTRfTjJmQVVmZ3Z2aTJnRURnSUFlSm1wRjNmTjhkeVVtNThfVG9rZW46S04zMmJ6dm1Ub1pVZjB4bkRCWWNVM3VZbjZkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWU2NmFhZmQ0Y2U4YzkyOTIxZjhjMGZiOTE2ZmRiOGVfZVJOejNDRnpyMEVVc3Q2OHFpak1mSjVWbnA1eXAyakRfVG9rZW46U2wySGI4ODdUb0ZwVjF4aUtpd2NXbzl6blBZXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="og:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MmJiZjlmNzRiNzJlODczZGUzMjQyMDI2YjAxMDMzZjhfa2tjOG1wMnY2MktnVllnWGJKYmVWZVBKc1hLVldUSU9fVG9rZW46U1BoTGJXdlNTb1huQkd4aUd3WWNFUWJabjdlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
<meta property="article:published_time" content="2024-10-26T05:53:14.358Z">
<meta property="article:modified_time" content="2024-10-26T05:58:09.820Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MzdmZjI1YzVhYmY3M2VjODc1ZmNkY2ZiMGY1OTU2MmZfcExhMkNoRThRTkpERzByU1pQMFpjY3RKQjdmZ2t4TkJfVG9rZW46TlhrdWJGdGpOb0RKVmF4Q1JCcWNRTXR6bmRiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/redefine-favicon.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/redefine-favicon.svg">
    <!--- Page Info-->
    
    <title>
        
            GAS学习记录第一季 | 沐云白的个人主页
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"沐云白的个人主页","subtitle":{"text":[],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.7.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":null},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/8/17 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>



<main class="page-container" id="swup">

    

    <div class="main-content-container flex flex-col justify-between min-h-dvh">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                沐云白的个人主页
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">4</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">GAS学习记录第一季</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/redefine-avatar.svg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">沐云白</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-10-26 13:53:14</span>
        <span class="mobile">2024-10-26 13:53:14</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-10-26 13:58:09</span>
            <span class="mobile">2024-10-26 13:58:09</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <p>第二季的c++内容更多，代码更扎实，也会注重更多细节，有关联机部分。</p>
<h1 id="0-基础知识"><a href="#0-基础知识" class="headerlink" title="0 基础知识"></a>0 基础知识</h1><p>事件</p>
<p>强调执行的时机，调用时只是触发而不会等待，执行在不同的线程。</p>
<p>不可使用局部变量，无返回值，可跨蓝图访问。</p>
<p>函数</p>
<p>强调执行的逻辑，调用会等待函数执行结果，执行在同一个线程中。</p>
<p>可以使用局部变量，有返回值，可跨蓝图访问。</p>
<p>宏</p>
<p>可以有多个输入输出，所以适用于类似if、switch这样的流控制，如flipflop函数就是用宏写的只能在同属一类的蓝图中进行访问。</p>
<h2 id="什么时候写蓝图、什么时候写c"><a href="#什么时候写蓝图、什么时候写c" class="headerlink" title="什么时候写蓝图、什么时候写c++"></a>什么时候写蓝图、什么时候写c++</h2><p>蓝图可以由设计师更改，所以像什么mesh或者collision什么的，就可以在蓝图中设置然后让设计师方便改，</p>
<h1 id="1-建立玩家和敌人的基类"><a href="#1-建立玩家和敌人的基类" class="headerlink" title="1 建立玩家和敌人的基类"></a>1 建立玩家和敌人的基类</h1><p>先建立基类。</p>
<p>基类是抽象类，不能被实例化通常包含虚函数或者纯虚函数，需要在派生类中重新实现。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UCLASS</span>(Abstract)<span class="comment">//表示该抽象类不能被实例化，通常包含虚函数或者纯虚函数，需要在派生类中重新实现。</span></span><br><span class="line"><span class="comment">//这个项目的代码是个3a级别的代码，所以会注重很多小细节</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AURA_GASLEARN_API</span> AAuraCharacterBase : <span class="keyword">public</span> ACharacter</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Sets default values for this character&#x27;s properties</span></span><br><span class="line">    <span class="built_in">AAuraCharacterBase</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// Called when the game starts or when spawned</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BeginPlay</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//智能指针</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,Category=<span class="string">&quot;Combat&quot;</span>)</span><br><span class="line">    TObjectPtr&lt;USkeletalMeshComponent&gt; Weapon;<span class="comment">//什么用查一下 这个是个骨骼组件</span></span><br><span class="line"><span class="comment">//删掉tick，这个是比较号性能的</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>还有就是要删去tick，节约性能。</p>
<p><strong>TObjectPtr的作用：</strong></p>
<p>由于UE5放弃了对32位系统的支持，从而只考虑64位的指针。而在现有的硬件条件下，<a class="link" target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?q=%E5%AF%BB%E5%9D%80%E7%A9%BA%E9%97%B4&zhida_source=entity&is_preview=1">寻址空间 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>不可能将指针的64位全部用完。因此，这64位就可以用来存储额外的信息：这样就可以把UObject的<a class="link" target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?q=%E9%9D%99%E6%80%81%E5%BC%95%E7%94%A8&zhida_source=entity&is_preview=1">静态引用 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>关系编码到这64位中，运行时再解析为<a class="link" target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?q=%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80&zhida_source=entity&is_preview=1">内存地址 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。同时，在这种封装中，就可以在访问变量等需要Debug的时机加入Hook点，这样就可以很方便的通过注册Hook函数进行Debug。</p>
<p><a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/504115127">https://zhuanlan.zhihu.com/p/504115127 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>暂时看不懂）！！</p>
<p>然后继承该基类，创建玩家类和敌人类即可。</p>
<h1 id="2-配置武器以及挂点"><a href="#2-配置武器以及挂点" class="headerlink" title="2 配置武器以及挂点"></a>2 配置武器以及挂点</h1><h2 id="2-1-在c-中配置武器"><a href="#2-1-在c-中配置武器" class="headerlink" title="2.1 在c++中配置武器"></a>2.1 在c++中配置武器</h2><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,Category=<span class="string">&quot;Combat&quot;</span>)</span><br><span class="line">TObjectPtr&lt;USkeletalMeshComponent&gt; Weapon;</span><br><span class="line">Weapon = <span class="built_in">CreateDefaultSubobject</span>&lt;USkeletalMeshComponent&gt;(<span class="string">&quot;Weapon&quot;</span>);<span class="comment">//创建</span></span><br><span class="line">Weapon-&gt;<span class="built_in">SetupAttachment</span>(<span class="built_in">GetMesh</span>(),<span class="built_in">FName</span>(<span class="string">&quot;WeaponSocket&quot;</span>));<span class="comment">//获取骨骼位置</span></span><br><span class="line">Weapon-&gt;<span class="built_in">SetCollisionEnabled</span>(ECollisionEnabled::NoCollision);<span class="comment">//设置碰撞</span></span><br></pre></td></tr></table></figure></div>

<p>2.2 在敌人和玩家的骨骼中添加socket调整weapon的位置</p>
<h1 id="3-创建动画"><a href="#3-创建动画" class="headerlink" title="3 创建动画"></a>3 创建动画</h1><h2 id="3-1-主角动画"><a href="#3-1-主角动画" class="headerlink" title="3.1 主角动画"></a>3.1 主角动画</h2><p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MzdmZjI1YzVhYmY3M2VjODc1ZmNkY2ZiMGY1OTU2MmZfcExhMkNoRThRTkpERzByU1pQMFpjY3RKQjdmZ2t4TkJfVG9rZW46TlhrdWJGdGpOb0RKVmF4Q1JCcWNRTXR6bmRiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>machine连接slot再导出，slot是为以后做的接口。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MmMyZjU1NmU2OGQyMDQxNTZjN2JjZjAzNmUwOTY2OGZfeURiVFhFcTdocENBd2ZOYWxBRWJRSm16amZWanVHZVhfVG9rZW46SW9remI1dEc0b0NSN1J4M3Vhc2NPTVBrbmplXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>Walk&#x2F;Idle：</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NGNkM2I5ZWZiZjI0ZTM1ZTI5NzczYmZjYmFjNmM5YjJfSHl6d1pZRmxQMGxYOUN4S0hRRXlLcWJBVzd0MVNBNExfVG9rZW46SWNRU2JJN0czb0lJbHZ4ZFpSc2M4YXpNbkpkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>放入动画，将变量提出来。</p>
<p>然后事件蓝图中为其赋值</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NjFiYzFjZTJiYTc4ZGRkM2I3NTg5MDYwNjA4ZWI3ZTZfVnVmMXFDZnJodjVIRmpGN0drRTJKTnlHMlQwVlY4WGJfVG9rZW46VExzRmJrMmlib3ZTTm14TXhENGNocGpIbmFmXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>比较重要的是有效获取的节点</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ODQxNTQxZjFiZjNlMzYyZTJkMWIyNWZhMGUzMzZiMGRfNFpGdVFmRElPaUZkSDgzR1RaRHVvd0NpZkRCWGFzaHpfVG9rZW46VGJrOGJ6R2x0b0UwR1h4dUlNbWM1SE12bkFmXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>这个可以保证有效获取，可以少写一个判断节点。</p>
<h2 id="3-2-怪物的动画"><a href="#3-2-怪物的动画" class="headerlink" title="3.2 怪物的动画"></a>3.2 怪物的动画</h2><p>制作逻辑也是一样的，但是因为怪物有很多个，我们需要创建一个模板类，让每个怪物去继承它。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YzNiMzg3MzI2MTVjZjE4OTk2MWU0OWIwZDUyM2EyZDRfd21BcTI0STdJRms4RUNPS3YweXYyT3VBN01WMGFLTldfVG9rZW46SHRJS2J2bEN6b2NzTmt4VXRsN2NibG1ibmtnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MjdkMjFlYmQxZTNkYzM0YzQ5MmMyYmRiZDU2NjcyMjdfb0NEZmNlc09ZSW1sWmtEazE3OUNHeEt6MllBV3NwZWhfVG9rZW46WGREaGJQcjBtb2lvQ2R4bTk2eWNFNVp3bjRjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>其中Walk&#x2F;Idle是这样的，Blendspace Player可以被替换成对应怪物的动画。</p>
<h1 id="4-增强输入与坐标轴"><a href="#4-增强输入与坐标轴" class="headerlink" title="4 增强输入与坐标轴"></a>4 增强输入与坐标轴</h1><p>优点是很灵活，可以适配不同情景但是可以用同一套键位。</p>
<p>先创建IA InputAction 就是映射的结果，更改为axis2D，然后创建IMC </p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDRjY2UyZTlhN2Y2Y2JjOTE3NGU4OGVhOWQ3ZjY5ODVfY1dLbzhmcHNjVTFROW5QSmNzZ3RoemZaaEJQV3VpSmRfVG9rZW46SFF2Q2J4TFR6b3E4U1B4Nko4UGN2RXhBbmJlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>在其中添加键位然后映射到IA_Move中，其中键位的输入默认是朝向右手坐标系的x轴正方向移动，也就是默认往右移动，而场景中的是左手坐标系，这个使用的时候需要反过来。</p>
<h1 id="5-配置按键映射情景"><a href="#5-配置按键映射情景" class="headerlink" title="5 配置按键映射情景"></a>5 配置按键映射情景</h1><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraPlayerControllerBase::BeginPlay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">BeginPlay</span>();</span><br><span class="line">    <span class="comment">//因为变量是在蓝图中去赋值，所以不用在构造函数中写，只需要在begin的时候检查一下</span></span><br><span class="line">    <span class="built_in">check</span>(AuraContext);<span class="comment">//断言，也就是检查变量是否存在。不存在直接崩溃，并且debug时会指到这。</span></span><br><span class="line">    <span class="comment">//得到本地玩家增强输入的子系统</span></span><br><span class="line">    UEnhancedInputLocalPlayerSubsystem* Subsystem=ULocalPlayer::<span class="built_in">GetSubsystem</span>&lt;UEnhancedInputLocalPlayerSubsystem&gt;(<span class="built_in">GetLocalPlayer</span>());</span><br><span class="line">    <span class="built_in">check</span>(Subsystem);</span><br><span class="line">    <span class="comment">//添加输入情景</span></span><br><span class="line">    Subsystem-&gt;<span class="built_in">AddMappingContext</span>(AuraContext,<span class="number">0</span>);<span class="comment">//优先级</span></span><br><span class="line">    <span class="comment">//显示鼠标并且不要锁定在视角中间</span></span><br><span class="line">    bShowMouseCursor=<span class="literal">true</span>;</span><br><span class="line">    DefaultMouseCursor=EMouseCursor::Default;<span class="comment">//鼠标样式</span></span><br><span class="line"></span><br><span class="line">    FInputModeGameAndUI InputModeData;<span class="comment">// 是一个枚举值，用于设置玩家控制器的输入模式，以便同时处理游戏和用户界面（UI）的输入。当你想要在游戏和 UI 之间切换输入处理时，这个枚举值非常有用。</span></span><br><span class="line">    InputModeData.<span class="built_in">SetLockMouseToViewportBehavior</span>(EMouseLockMode::DoNotLock);<span class="comment">//鼠标不锁在屏幕中间</span></span><br><span class="line">    InputModeData.<span class="built_in">SetHideCursorDuringCapture</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">SetInputMode</span>(InputModeData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="6-编写绑定函数"><a href="#6-编写绑定函数" class="headerlink" title="6 编写绑定函数"></a>6 编写绑定函数</h1><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraPlayerControllerBase::SetupInputComponent</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">SetupInputComponent</span>();</span><br><span class="line">    UEnhancedInputComponent* EnhancedInputComponent = <span class="built_in">CastChecked</span>&lt;UEnhancedInputComponent&gt;(InputComponent);</span><br><span class="line">    <span class="comment">//强制转换，转换失败就崩溃</span></span><br><span class="line">    EnhancedInputComponent-&gt;<span class="built_in">BindAction</span>(MoveAction,ETriggerEvent::Triggered,<span class="keyword">this</span>,&amp;AAuraPlayerControllerBase::Move);</span><br><span class="line">    <span class="comment">//按键映射绑定Move函数</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraPlayerControllerBase::Move</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; InputActionValue)</span><span class="comment">//将其对应</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="type">const</span> FVector2D InputAxisVector = InputActionValue.<span class="built_in">Get</span>&lt;FVector2D&gt;();</span><br><span class="line">    <span class="function"><span class="type">const</span> FRotator <span class="title">YawRotation</span><span class="params">(<span class="number">0.f</span>,GetControlRotation().Yaw,<span class="number">0.f</span>)</span></span>;<span class="comment">//通过Yaw值可以知道角色的朝向</span></span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> FVector ForwardDir =<span class="built_in">FRotationMatrix</span>(YawRotation).<span class="built_in">GetUnitAxis</span>(EAxis::X);</span><br><span class="line">    <span class="type">const</span> FVector RightDir=<span class="built_in">FRotationMatrix</span>(YawRotation).<span class="built_in">GetUnitAxis</span>(EAxis::Y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(APawn* ControllerPawn = <span class="built_in">GetPawn</span>())<span class="comment">//没用断言：因为playerController的调用是很早的，很可能玩家还没生成出来 而且其绑定在输入中，会在每一帧被调用，写断言意义不大</span></span><br><span class="line">    &#123;</span><br><span class="line">       ControllerPawn-&gt;<span class="built_in">AddMovementInput</span>(ForwardDir,InputAxisVector.Y);<span class="comment">//现在是右手坐标系了，UE中是右手坐标系，而增强输入中是左手坐标系，所以要变化一下</span></span><br><span class="line">       ControllerPawn-&gt;<span class="built_in">AddMovementInput</span>(RightDir,InputAxisVector.X);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="7-设置GM使玩家动起来"><a href="#7-设置GM使玩家动起来" class="headerlink" title="7 设置GM使玩家动起来"></a>7 设置GM使玩家动起来</h1><p>PlayerMode放在Game文件夹下，PlayerController放在Player文件夹下，是因为PlayerMode是存放在服务器的，PlayerController是在客户端和服务端都有的。</p>
<p>在worldsetting里设置对应的BP_类就可以控制角色移动了。</p>
<p>但现在角色不能正常转向一起相机位置不对，在BP_Aura中设置spring和camera调整spring位置和角度。</p>
<p>现在对一些设置进行调整，</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDNlNmZkZDdjMWExNDdkNDA4NzM2ODAyN2YxZWMzNDBfU1JNb3NON1VvdDB3RXhhNlNoRHZWM3lqUjZsOEQ0ekZfVG9rZW46SGRCUWJsYkpwb3ZiY1l4YmtxSWNTZHpjbm9iXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MjI5ZmFhYzlkMGNlZWQyNmFkNGJkYmI4NzE1YzhkNmNfSDhsNTZrQ202dng4TjNCc1NTMUJhZG16TmF2YUZxclFfVG9rZW46QXllbGJ0a3hvb3Bpd1J4Wk4xVmNJS0o5bjNlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTg2NDE0NDdkNjg0ODdjOTMwMTk5NWIxMDU1MjVkM2Vfc2xqVlQybmV5bFJSS3pZVkxRbmk1R21oNkdJZGhYQW5fVG9rZW46Q0x5bmJJckFob2pYQ3V4WnJqZGNMUnlqbnhkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>转身角度调成500会更自然一些。</p>
<p>现在调整停下转头太快的问题。</p>
<p>解决办法是给动画添加一个缓冲。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTFjODA2NzFkZmE3NjliZDYzMDYwOTY1NjFjNjY1ZDVfMldsZWhrWnZMSGpyeUh3YU1zZnhEdUJBOEhpVDhQcVVfVG9rZW46VTExN2IxanR2b3l1Qjl4Z3FETWNvYTdWbmFkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>在其中设置个bool变量判断，根据速度来修改bool变量就行，主要也就是给个缓冲即可。</p>
<h1 id="8-编写沟边"><a href="#8-编写沟边" class="headerlink" title="8 编写沟边"></a>8 编写沟边</h1><p>类似于lol，把鼠标放到敌人身上会有红色的沟边，因为要对很多类型的实例生效，所以写一个接口来实现，</p>
<p>大致逻辑很简单，大概就是检测under鼠标下的射线，看射线射到的是不是带有IEnemyInterface接口的actor，</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AURA_GASLEARN_API</span> IEnemyInterface</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"><span class="keyword">public</span>:<span class="comment">//要写在public下，其他类中才能检测调用虚函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">HightLightActor</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">UnHightLightActor</span><span class="params">()</span> </span>= <span class="number">0</span>;<span class="comment">//纯虚函数</span></span><br><span class="line">    <span class="comment">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>然后再enemy中实现该接口。一定要覆写纯虚函数。 bHightLightActor是检测变量，检测是否hightlight</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AURA_GASLEARN_API</span> AAuraEnemy : <span class="keyword">public</span> AAuraCharacterBase,<span class="keyword">public</span> IEnemyInterface</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadOnly)</span><br><span class="line">    <span class="type">bool</span> bHightLightActor =<span class="literal">false</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">HightLightActor</span><span class="params">()</span>  <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">UnHightLightActor</span><span class="params">()</span>  <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>然后需要写鼠标的射线检测，需要写在controller下。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IEnemyInterface* LastActor;</span><br><span class="line">IEnemyInterface* ThisActor;</span><br></pre></td></tr></table></figure></div>

<p>先写两个变量定义，用来检测是否有拥有对应接口的actor。需要记录之前的actor是因为，需要将已经挪开的actor给取消沟边。</p>
<p>射线检测以及判断的代码如下：</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraPlayerControllerBase::CursorTrace</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FHitResult CursorHit;</span><br><span class="line">    <span class="built_in">GetHitResultUnderCursor</span>(ECC_Visibility,<span class="literal">false</span>,CursorHit);<span class="comment">//获取鼠标下的射线</span></span><br><span class="line">    <span class="keyword">if</span>(!CursorHit.<span class="built_in">GetActor</span>())<span class="keyword">return</span>;</span><br><span class="line">    LastActor=ThisActor;</span><br><span class="line">    <span class="comment">//检查现在击中的这个actor有没有实现这个接口</span></span><br><span class="line">    ThisActor=<span class="built_in">Cast</span>&lt;IEnemyInterface&gt;(CursorHit.<span class="built_in">GetActor</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(LastActor==<span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="keyword">if</span>(ThisActor!=<span class="literal">nullptr</span>)</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="comment">//情况2</span></span><br><span class="line">          ThisActor-&gt;<span class="built_in">HightLightActor</span>();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">          <span class="comment">//情况1</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">//上一个有值</span></span><br><span class="line">    &#123;</span><br><span class="line">       <span class="keyword">if</span> (ThisActor==<span class="literal">nullptr</span>)</span><br><span class="line">       &#123;</span><br><span class="line">          LastActor-&gt;<span class="built_in">UnHightLightActor</span>();</span><br><span class="line">          <span class="comment">//3</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">          <span class="keyword">if</span>(LastActor==ThisActor)</span><br><span class="line">          &#123;</span><br><span class="line">             <span class="comment">//5</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">             <span class="comment">//4</span></span><br><span class="line">             LastActor-&gt;<span class="built_in">UnHightLightActor</span>();</span><br><span class="line">             ThisActor-&gt;<span class="built_in">HightLightActor</span>();</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">          </span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p> 主要复杂在有很多情况需要单独判断，</p>
<ol>
<li>前者没有接口，后者有接口，需要给后者描边。</li>
<li>前者没有接口，后者没有接口，不需要做行动。</li>
<li>前者有接口，后者没有接口，需要给后者去掉描边。</li>
<li>前者有接口，后者有接口，前者和后者为同一个，不需要做行动。</li>
<li>前者有接口，后者有接口，前者和后者不为同一个，需要给前者去掉描边，给后者描边。</li>
</ol>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MzEwNGNkYjVjYzI3NzFkZTJkMGE5ODU3NzAxY2ViOTRfOVFIVmFXOVpVYUlaVHdoWVQ2SWV4R0FLVjNQR0tFdWtfVG9rZW46TzVXR2JDTlhVb01TQ2F4QUgydmNpMDZlbmpkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<h1 id="9-创建GAS"><a href="#9-创建GAS" class="headerlink" title="9 创建GAS"></a>9 创建GAS</h1><p>AbilitySystemComponent-&gt;SetReplicationMode()；</p>
<p>该system上传到服务器的mode：</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWVlNGVmNjU2YmE2ODlhMzFiN2FkNjg3MjBhN2ZiOWVfRXhpbWp6Y3BHTzhDbTJCUUZRaERjcVFoWnA0dzlMSlpfVG9rZW46SGI4N2I1djlRb1dPNGR4VWdQU2NuOHNxbndjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<h2 id="9-1-初始化的时机："><a href="#9-1-初始化的时机：" class="headerlink" title="9.1 初始化的时机："></a>9.1 初始化的时机：</h2><p>因lives in Pawn的话是为了让他在生成的同时获得ASC，state的主要是做一个检查作用，保证开始时拥有ASC，</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YjI1ZTRiMWIwZjJlYjQzMGQzZjY2M2IxODJjN2JkODhfdXFXUjFZUUExTHFzRzZIOGtmNUFYcldIMmh4cW1qaEFfVG9rZW46RGtGemJTMDB1b3ZHcHp4OWFLZ2NMVHV0blBkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTRkODYyNTEyYzUwNDdhZjBiMjhiZDY3N2JiMDMwNTFfeXMyVng2TDAwVXZBUVdYMkdTRnd6aURjeDFTdnRMeUlfVG9rZW46WDJZZmJtdW9Ub0R3clp4b3lKRGNLOTB3bmJnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>OwnerActor AvatarActor</p>
<p>附有<code>ASC</code>的Actor被称为<code>ASC</code>的<code>OwnerActor</code>。<code>ASC</code>的实际作用的Actor被称为<code>AvatarActor</code>。<code>OwnerActor</code>和<code>AvatarActor</code>可以是同一个Actor，就像MOBA游戏中的一个简单的AI小兵。他们也可以是不同的Actor，比如在MOBA游戏中玩家控制的英雄，<code>OwnerActor</code>是<code>PlayerState</code>，<code>AvatarActor</code>是英雄的角色类。大多数Actor都会把<code>ASC</code>放在自己身上。如果你的角色会重生，并且在重生之间需要<code>Attributes</code>或<code>GameplayEffects</code>的持续（就像MOBA游戏中的英雄），那么<code>ASC</code>的理想位置是在<code>PlayerState</code>上。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ODUzOTlmM2JiZGIyMDVkNDQ4NGE1ZjFiOWU3NmI5YzdfZ2I1SUgxSVdqSjI2aFhpMVZKcDdNbTFiUEtzblNJcElfVG9rZW46T2pzUmJGZUxjb3p6S2Z4VnpWcGNwUVo0bnJnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>重点也就是OwnerActor得是controller。</p>
<h3 id="为什么Player的OwnerActor是PlayerState，AvatarActor是Character："><a href="#为什么Player的OwnerActor是PlayerState，AvatarActor是Character：" class="headerlink" title="为什么Player的OwnerActor是PlayerState，AvatarActor是Character："></a>为什么Player的OwnerActor是PlayerState，AvatarActor是Character：</h3><p>因为每个客户端只有一个character，playerstate是绑定对应客户端的，也就是客户端是controller。</p>
<h1 id="10-SetAttribute"><a href="#10-SetAttribute" class="headerlink" title="10 SetAttribute"></a>10 SetAttribute</h1><p>产生GE时，是客户端先产生效果，然后再通知服务器，再由服务端检验，不然的话就需要预测，服务端提前预测客户端会产生什么游戏效果，这个是非常消耗性能且不稳定的事情。</p>
<p>.h：</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UAuraAttributeSet</span>();</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span>  <span class="type">void</span> <span class="title">GetLifetimeReplicatedProps</span><span class="params">(TArray&lt;FLifetimeProperty&gt;&amp; OutLifetimeProps)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintReadOnly,ReplicatedUsing=OnRep_Health,Category=<span class="string">&quot;Vital Atttttributes&quot;</span>)</span><br><span class="line">    FGameplayAttributeData Health;</span><br><span class="line">    <span class="built_in">UFUNCTION</span>()</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">OnRep_Health</span><span class="params">(<span class="type">const</span> FGameplayAttributeData&amp; OldHealth)</span> <span class="type">const</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>.cpp：</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAuraAttributeSet::GetLifetimeReplicatedProps</span><span class="params">(TArray&lt;FLifetimeProperty&gt;&amp; OutLifetimeProps)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">GetLifetimeReplicatedProps</span>(OutLifetimeProps);</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//在记录数值以便同步，always是因为GAS中，很多时候同步的值不变也需要进行一些游戏效果</span></span><br><span class="line">    <span class="built_in">DOREPLIFETIME_CONDITION_NOTIFY</span>(UAuraAttributeSet,Health,COND_None,REPNOTIFY_Always);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">UAuraAttributeSet::OnRep_Health</span><span class="params">(<span class="type">const</span> FGameplayAttributeData&amp; OldHealth)</span> <span class="type">const</span><span class="comment">//同步客户端和服务器的通常写法，同步的时候可以知道旧值</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//保持属性系统的协同，通知客户端已经从服务器上下载了一个值，在能力系统中更改并跟踪旧值，以防止需要回滚数据</span></span><br><span class="line">    <span class="built_in">GAMEPLAYATTRIBUTE_REPNOTIFY</span>(UAuraAttributeSet,Health,OldHealth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="11-设置、获取-属性值"><a href="#11-设置、获取-属性值" class="headerlink" title="11 设置、获取 属性值"></a>11 设置、获取 属性值</h1><p>使用宏为Attribute创建函数，创建get set函数等。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ATTRIBUTE_ACCESSORS(ClassName, PropertyName) \</span></span><br><span class="line"><span class="meta">    GAMEPLAYATTRIBUTE_PROPERTY_GETTER(ClassName, PropertyName) \</span></span><br><span class="line"><span class="meta">    GAMEPLAYATTRIBUTE_VALUE_GETTER(PropertyName) \</span></span><br><span class="line"><span class="meta">    GAMEPLAYATTRIBUTE_VALUE_SETTER(PropertyName) \</span></span><br><span class="line"><span class="meta">    GAMEPLAYATTRIBUTE_VALUE_INITTER(PropertyName)</span></span><br></pre></td></tr></table></figure></div>

<p>用</p>
<p>ATTRIBUTE_ACCESSORS(UAuraAttributeSet,Health); </p>
<p>就可以为该FGameplayAttributeData创建对应的获取函数。</p>
<h1 id="12-制作一个actor可以触发GameEffect"><a href="#12-制作一个actor可以触发GameEffect" class="headerlink" title="12 制作一个actor可以触发GameEffect"></a>12 制作一个actor可以触发GameEffect</h1><p>需要制作先碰撞，然后触发attributeSet修改Health值，打算通过碰撞触发游戏效果。</p>
<p>触发碰撞模板：</p>
<p>.h</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UFUNCTION</span>()</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnOverlap</span><span class="params">(UPrimitiveComponent* OverlappedComponent,AActor* OtherActor,UPrimitiveComponent* OtherComp,int32 OtherBodyIndex,<span class="type">bool</span> bFromSweep,<span class="type">const</span> FHitResult&amp; SweepResult)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">UFUNCTION</span>()</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">EndOverlap</span><span class="params">(UPrimitiveComponent* OverlappedComponent, AActor* OtherActor, UPrimitiveComponent* OtherComp, int32 OtherBodyIndex)</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>.cpp</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraEffectActor::OnOverlap</span><span class="params">(UPrimitiveComponent* OverlappedComponent, AActor* OtherActor,</span></span></span><br><span class="line"><span class="params"><span class="function">    UPrimitiveComponent* OtherComp, int32 OtherBodyIndex, <span class="type">bool</span> bFromSweep, <span class="type">const</span> FHitResult&amp; SweepResult)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (IAbilitySystemInterface* ASCInterface = <span class="built_in">Cast</span>&lt;IAbilitySystemInterface&gt;(OtherActor))</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="type">const</span> UAuraAttributeSet* AuraAttributeSet = <span class="built_in">Cast</span>&lt;UAuraAttributeSet&gt;(ASCInterface-&gt;<span class="built_in">GetAbilitySystemComponent</span>()-&gt;<span class="built_in">GetAttributeSet</span>(UAuraAttributeSet::<span class="built_in">StaticClass</span>()));</span><br><span class="line"></span><br><span class="line">       UAuraAttributeSet* MutableAuraAttributeSet = <span class="built_in">const_cast</span>&lt;UAuraAttributeSet*&gt;(AuraAttributeSet);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraEffectActor::EndOverlap</span><span class="params">(UPrimitiveComponent* OverlappedComponent, AActor* OtherActor,</span></span></span><br><span class="line"><span class="params"><span class="function">    UPrimitiveComponent* OtherComp, int32 OtherBodyIndex)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="13-制作一个GlobeProgressBar的基类"><a href="#13-制作一个GlobeProgressBar的基类" class="headerlink" title="13 制作一个GlobeProgressBar的基类"></a>13 制作一个GlobeProgressBar的基类</h1><p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Q0MTljMTVkYmFiN2U2NTA5NWU5ODY2YTZhNWIwNGFfZUU0VXFwTE9XbzZ4cjd1eEFkNEdGdTZoZnJrUmtEQk9fVG9rZW46TUR4RmJZU3oxb2lUVUd4NUdTRmNxSUNSbjVjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>先是创建这几项， sizeBox可以设置size，Overlay的下的物体可以叠加显示。</p>
<p>然后是创建可以在子类被override的函数，使得该组件的复用性更好，</p>
<p>13.1 UpdateBoxSize</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MmNiNmQwYjYzNDU0M2M3YWNhOTdkZjcyZGYzNDE3NWRfbjVhMlMzemRiZ1RXS3hLR05oNDhHVXByNkxpQUxNS0tfVG9rZW46RzdBR2JSaFY0b2xCRjZ4Tlo0RmNRVm9zbnZkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>13.2 UpdateBackgroundBrush</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDNmNTJkNGY0M2U2MjdmMzQxMmQ2ZjkwMzgzNzdmMTFfQXRVQ2ZnZVkwajZqSjhFa3VFNkFTdmRDYnhES0tuZmdfVG9rZW46QWR3dWJnbWVJb0xsV3N4bENLU2N3ekJsbnhkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>13.3 UpdateGlobeImage</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTVmM2RkYTgzMWFhZmI4YzM0YThkMTk2MzAxMzI3NDRfd3RXeXFRS0QySTBFQUYzb0VNaTYwSE9qalpwRDlLMXNfVG9rZW46RFlwVWJvT2Frb0lnZ3B4cFBNMGM1VmxsbkljXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>13.4 UpdateGlobePadding</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDE3MTlkZGZhMzY2ZWI0MWY0MzA4NWFjZThjZjhkYjFfamFPbkpqNGhWc0ljNm5LU1htcWhqaUtMSWJoZGFRYkZfVG9rZW46WkVlbGJTQ0ZKb0tub0x4aVVoTGNpRTBNbmVlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>13.5 UpdateGlass</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YzgwMDdhMjdjMGU0ZTY4OTg5NzFlZGRhNzg2MzZmODZfUkxSY2IxNVFLbWJ5Tk1WWEpOejByTzBHMkFtYlo5T05fVG9rZW46TXlTMmI5Uzljb2k1MHB4b0RjVmNnVmJxbmZiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<h1 id="14-HUD-设置"><a href="#14-HUD-设置" class="headerlink" title="14 HUD  设置"></a>14 HUD  设置</h1><p>建立HUD Cpp类</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AURA_GASLEARN_API</span> AAuraHUD : <span class="keyword">public</span> AHUD</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UPROPERTY</span>()</span><br><span class="line">    TObjectPtr&lt;UAuraUserWidget&gt; OverlayWidget;</span><br><span class="line"></span><br><span class="line">    <span class="function">UOverlayWidgetController* <span class="title">GetOverlayWidgetController</span><span class="params">(<span class="type">const</span> FWidgetControllerParams WCParams)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BeginPlay</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere)</span><br><span class="line">    TSubclassOf&lt;UAuraUserWidget&gt; OverlayWidgetClass;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>()</span><br><span class="line">    TObjectPtr&lt;UOverlayWidgetController&gt; OverlayWidgetController;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere)</span><br><span class="line">    TSubclassOf&lt;UOverlayWidgetController&gt; OverlayWidgetControllerClass;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraHUD::BeginPlay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">BeginPlay</span>();</span><br><span class="line"></span><br><span class="line">    UUserWidget* Widget = <span class="built_in">CreateWidget</span>&lt;UUserWidget&gt;(<span class="built_in">GetWorld</span>(),OverlayWidgetClass);</span><br><span class="line">    Widget-&gt;<span class="built_in">AddToViewport</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>然后在蓝图中的OverlayWidgetControllerClass填入我们前面完成的Overlay Widget即可。</p>
<h1 id="15-Overlay-Widget-Controller"><a href="#15-Overlay-Widget-Controller" class="headerlink" title="15 Overlay Widget Controller"></a>15 Overlay Widget Controller</h1><p> 先设置一个u结构体，这样定义WidgetController参数的时候会更方便</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType)</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FWidgetControllerParams</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">FWidgetControllerParams</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">FWidgetControllerParams</span>(APlayerController* PC, APlayerState* PS,UAbilitySystemComponent* ASC, UAttributeSet* AS)</span><br><span class="line">    : <span class="built_in">PlayerController</span>(PC),<span class="built_in">PlayerState</span>(PS),<span class="built_in">AbilitySystemComponent</span>(ASC),<span class="built_in">AttributeSet</span>(AS)&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    TObjectPtr&lt;APlayerController&gt; PlayerController = <span class="literal">nullptr</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    TObjectPtr&lt;APlayerState&gt; PlayerState = <span class="literal">nullptr</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    TObjectPtr&lt;UAbilitySystemComponent&gt; AbilitySystemComponent = <span class="literal">nullptr</span>;</span><br><span class="line">    </span><br><span class="line">       <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    TObjectPtr&lt;UAttributeSet&gt; AttributeSet = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>设置参数。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAuraWidgetController::SetWidgetControllerParams</span><span class="params">(<span class="type">const</span> FWidgetControllerParams&amp; WCParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PlayerController = WCParams.PlayerController;</span><br><span class="line">    PlayerState = WCParams.PlayerState;</span><br><span class="line">    AbilitySystemComponent = WCParams.AbilitySystemComponent;</span><br><span class="line">    AttributeSet=WCParams.AttributeSet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>基于WidgetController 创建Overlay Widget Controller</p>
<p>在HUD.cpp中，获取Overlay Widget Controller</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">UOverlayWidgetController* <span class="title">AAuraHUD::GetOverlayWidgetController</span><span class="params">(<span class="type">const</span> FWidgetControllerParams WCParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(OverlayWidgetController==<span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">       OverlayWidgetController = <span class="built_in">NewObject</span>&lt;UOverlayWidgetController&gt;(<span class="keyword">this</span>,OverlayWidgetControllerClass);</span><br><span class="line">       OverlayWidgetController-&gt;<span class="built_in">SetWidgetControllerParams</span>(WCParams);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> OverlayWidgetController;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  OverlayWidgetController;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>然后我们需要初始化Overlay Widget和Controller，删除原本写在BeginPlay的部分，单独建立一个函数来进行初始化。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraHUD::InitOverlay</span><span class="params">(APlayerController* PC, APlayerState* PS, UAbilitySystemComponent* ASC, UAttributeSet* AS)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">checkf</span>(OverlayWidgetClass,<span class="built_in">TEXT</span>(<span class="string">&quot;uninitialized,please fill out BP_AuraHUD&quot;</span>));</span><br><span class="line">    <span class="built_in">checkf</span>(OverlayWidgetControllerClass,<span class="built_in">TEXT</span>(<span class="string">&quot;uninitialized,please fill out BP_AuraHUD&quot;</span>))</span><br><span class="line">    </span><br><span class="line">    UUserWidget* Widget = <span class="built_in">CreateWidget</span>&lt;UUserWidget&gt;(<span class="built_in">GetWorld</span>(),OverlayWidgetClass);</span><br><span class="line">    OverlayWidget = <span class="built_in">Cast</span>&lt;UAuraUserWidget&gt;(Widget);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> FWidgetControllerParams <span class="title">WidgetControllerParams</span><span class="params">(PC,PS,ASC,AS)</span></span>;</span><br><span class="line">    UOverlayWidgetController* WidgetController =<span class="built_in">GetOverlayWidgetController</span>(WidgetControllerParams);</span><br><span class="line"></span><br><span class="line">    OverlayWidget-&gt;<span class="built_in">SetWidgetController</span>(WidgetController);</span><br><span class="line">    </span><br><span class="line">    Widget-&gt;<span class="built_in">AddToViewport</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>checkf检查完会输出字符串。</p>
<h1 id="16-Broadcast-Initial-Values"><a href="#16-Broadcast-Initial-Values" class="headerlink" title="16 Broadcast Initial Values"></a>16 Broadcast Initial Values</h1><p>OverWidgetController.h</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//建立动态多播委托，因为要在蓝图中为其分配事件，多播是因为有多个蓝图，可能想要绑定在这些委托的多个小部件蓝图上</span></span><br><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(FOnHealthChangedSignature,<span class="type">float</span>,NewHealth);<span class="comment">//意思是只广播一个参数</span></span><br><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(FOnMaxHealthChangedSignature,<span class="type">float</span>,NewMaxHealth);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AURA_GASLEARN_API</span> UOverlayWidgetController : <span class="keyword">public</span> UAuraWidgetController</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BroadcastInitialValues</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintAssignable,Category=<span class="string">&quot;GAS|Attributs&quot;</span>)</span><br><span class="line">    FOnHealthChangedSignature OnHealthChanged;<span class="comment">//可以在蓝图上绑定到这个委托</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(BlueprintAssignable,Category=<span class="string">&quot;GAS|Attributs&quot;</span>)</span><br><span class="line">    FOnMaxHealthChangedSignature OnMaxHealthChanged;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>cpp</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UOverlayWidgetController::BroadcastInitialValues</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="type">const</span> UAuraAttributeSet* AuraAttributeSet=<span class="built_in">CastChecked</span>&lt;UAuraAttributeSet&gt;(AttributeSet);</span><br><span class="line"> <span class="comment">//AttributeSet里的值是系统中的值，这里要Broadcast的是要在HUD中显示的值，获取AttributeSet中的值来传播。</span></span><br><span class="line"> OnHealthChanged.<span class="built_in">Broadcast</span>(AuraAttributeSet-&gt;<span class="built_in">GetHealth</span>());</span><br><span class="line"> OnMaxHealthChanged.<span class="built_in">Broadcast</span>(AuraAttributeSet-&gt;<span class="built_in">GetMaxHealth</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>在HUD的initOverlay中，调用该函数</p>
<p>这些是蓝图中无法实现的部分，现在要接入到蓝图中。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MTc5ZDRmMWVhYmRkYmFjNTIyNmQyYmYxNjY5Zjk4YzRfZGVleW9NNngxaG5JVFgxVVZ6OFEyODNYSTFOM0FwQ1hfVG9rZW46QXZ2QWJESGoxbzhsRnJ4VUxnSWNzdkxObjdhXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>从代码的初始化Overlay可知，是在initOverlay的时候set controller，在set controller的同时设置子物体的controller</p>
<p>然后在子物体的蓝图中在调用该event，绑定委托，接收数据设置参数。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=OTJkYWQ4OWJhOTk3YjAzZGNjMWQ4OTcwNWQxYmVmMjNfTlBnZ0VnbThuSEFoQnlKZHB6Mlk3M1dkWTgyS2I0NXRfVG9rZW46S0NQMmJJc1pYbzU5Nm14QnM3VmNxUmR3bkEzXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>manabar同理。</p>
<p>捋一下：就是你需要传播数据，所以你就需要从系统也就是attributeSet中读取数据然后传播出来，这个读取数据然后传播的媒介就是Controller， 接着就是controller的设置，我们需要传数据到什么地方？ 需要传数据给Overlay层，然后overlay往下管理HealthBar和manaBar，最终接收数据的是两个bar，所以我们就需要再overlay处set controller给bar，让他们接入controller，接着我们需要在bar也就是globe中去写bind OnhealthChange的函数，也就是绑定到前面的那个广播中，接收广播出来的数据。  广播的函数需要调用，哪在哪调用？在initOverlay处调用。</p>
<h1 id="17-Listening-for-attribute-Change"><a href="#17-Listening-for-attribute-Change" class="headerlink" title="17 Listening for attribute Change"></a>17 Listening for attribute Change</h1><p>需要绑定attribute里的数据变化，然后传播出来</p>
<p>核心函数：</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UOverlayWidgetController::BindCallbacksToDependencies</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="type">const</span> UAuraAttributeSet* AuraAttributeSet=<span class="built_in">CastChecked</span>&lt;UAuraAttributeSet&gt;(AttributeSet);</span><br><span class="line"> <span class="comment">//这个前半行是获取游戏属性值更改委托的输入，后面是触发该委托时会运行的回调函数，</span></span><br><span class="line"> AbilitySystemComponent-&gt;<span class="built_in">GetGameplayAttributeValueChangeDelegate</span>(</span><br><span class="line">  AuraAttributeSet-&gt;<span class="built_in">GetHealthAttribute</span>()).<span class="built_in">AddUObject</span>(<span class="keyword">this</span>,&amp;UOverlayWidgetController::HealthChanged);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> AbilitySystemComponent-&gt;<span class="built_in">GetGameplayAttributeValueChangeDelegate</span>(</span><br><span class="line">  AuraAttributeSet-&gt;<span class="built_in">GetMaxHealthAttribute</span>()).<span class="built_in">AddUObject</span>(<span class="keyword">this</span>,&amp;UOverlayWidgetController::MaxHealthChanged);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>这个就只是接收函数然后广播。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UOverlayWidgetController::HealthChanged</span><span class="params">(<span class="type">const</span> FOnAttributeChangeData&amp; Data)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> OnHealthChanged.<span class="built_in">Broadcast</span>(Data.NewValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UOverlayWidgetController::MaxHealthChanged</span><span class="params">(<span class="type">const</span> FOnAttributeChangeData&amp; Data)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> OnMaxHealthChanged.<span class="built_in">Broadcast</span>(Data.NewValue);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>然后就只剩下绑定的时机的问题，需要在哪绑定呢，和前面的逻辑差不多，什么时候构建（set）什么时候绑定进去，然后找回去，就是</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">UOverlayWidgetController* <span class="title">AAuraHUD::GetOverlayWidgetController</span><span class="params">(<span class="type">const</span> FWidgetControllerParams WCParams)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(OverlayWidgetController==<span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">       OverlayWidgetController = <span class="built_in">NewObject</span>&lt;UOverlayWidgetController&gt;(<span class="keyword">this</span>,OverlayWidgetControllerClass);</span><br><span class="line">       OverlayWidgetController-&gt;<span class="built_in">SetWidgetControllerParams</span>(WCParams);</span><br><span class="line">       OverlayWidgetController-&gt;<span class="built_in">BindCallbacksToDependencies</span>();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> OverlayWidgetController;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  OverlayWidgetController;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="18-重新构建EffectActor"><a href="#18-重新构建EffectActor" class="headerlink" title="18 重新构建EffectActor"></a>18 重新构建EffectActor</h1><h2 id="18-1-前提知识："><a href="#18-1-前提知识：" class="headerlink" title="18.1 前提知识："></a>18.1 前提知识：</h2><h3 id="FGameplayEffectSpec-蓝图引脚：Effect-Spec-Handle-Spec-Handle"><a href="#FGameplayEffectSpec-蓝图引脚：Effect-Spec-Handle-Spec-Handle" class="headerlink" title="FGameplayEffectSpec (蓝图引脚：Effect Spec Handle &#x2F; Spec Handle)"></a>FGameplayEffectSpec (蓝图引脚：Effect Spec Handle &#x2F; Spec Handle)</h3><p>GE 就是配置文件，而配置文件携带的信息一般来说是固定的；技能系统开发者为了让 GE 更灵活，留了一些后手，比如经典的 SetByCaller（动态设置参数） 、Level（根据等级获取对应的参数）、Custom Calculation Class（自定义计算要更改的属性值） 等</p>
<p>给目标施加 GE，除了 GE 本身配置还需要一些其它参数（比如：GE 等级、什么时候施加 GE、谁施加的 GE 等、GE 的目标是谁等）。因此施加 GE 需要包装一层，而这就是 FGameplayEffectSpec，那 FGameplayEffectSpecHandle 是啥呢？</p>
<p>FGameplayEffectSpec 是结构体，这表明它需要手动管理生命周期（new&#x2F;delete），但是它又可能用在不同生命周期的对象内（比如：在 GA 构造 Spec，然后把它传给 GA 产生的炮弹，炮弹命中目标时再使用，此时 GA 早已结束），因此FGameplayEffectSpecHandle 使用 TSharedPtr 包装 FGameplayEffectSpec ，TSharedPtr 内部会采用<a class="link" target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=209047615&content_type=Article&match_order=1&q=%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0&zhida_source=entity">引用计数 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>的方式，一旦引用数为零就会自动调用 delete</p>
<p>FGameplayEffectSpecHandle （蓝图一般使用 Make Spec Handle 来构建）本身则随着作用域的结束，会自动结束生命周期（因为它是在作用域的栈上产生的对象）</p>
<h3 id="FGameplayEffectContext-蓝图引脚：Effect-Context-Context"><a href="#FGameplayEffectContext-蓝图引脚：Effect-Context-Context" class="headerlink" title="FGameplayEffectContext (蓝图引脚：Effect Context &#x2F; Context)"></a>FGameplayEffectContext (蓝图引脚：Effect Context &#x2F; Context)</h3><p>FGameplayEffectContext 主要是用来传递内容，是 FGameplayEffectSpec 内的私有变量 EffectContext（官方的注释“<em>This tells us how we got here (who &#x2F; what applied us)</em> ”），可传递给UGameplayEffectExecutionCalculation，UGameplayCue 等使用。可以自定义 FGameplayEffectContext 添加想要的参数，自定义步骤：</p>
<ul>
<li>编写自定义CustomGameplayEffectContext 类，继承自 FGameplayEffectContext</li>
<li>编写自定义CustomAbilitySystemGlobals，继承自 UAbilitySystemGlobals，重载AllocGameplayEffectContext</li>
<li>设置AbilitySystemGlobalsClass ( DefaultGame.ini文件夹 )</li>
</ul>
<p>FGameplayEffectContextHandle 则是同上文一样的道理</p>
<h3 id="FGameplayAbilityTargetData-蓝图引脚：Target-Data"><a href="#FGameplayAbilityTargetData-蓝图引脚：Target-Data" class="headerlink" title="FGameplayAbilityTargetData (蓝图引脚：Target Data)"></a>FGameplayAbilityTargetData (蓝图引脚：Target Data)</h3><p>看名字就知道这个对象作用在 GA 内部，一般跟 AGameplayAbilityTargetActor 一起使用，主要作用是用来在技能中查找目标。比如：在使用技能的时候，需要检测玩家正前方的所有玩家，那么就可以 Spawn 一个AGameplayAbilityTargetActor_SingleLineTrace，利用它内部的<a class="link" target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=209047615&content_type=Article&match_order=1&q=%E5%B0%84%E7%BA%BF%E6%A3%80%E6%B5%8B&zhida_source=entity">射线检测 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>获取目标对象。然后用 Wait Target Data Using Actor 去获取 FGameplayAbilityTargetData</p>
<p>使用 AGameplayAbilityTargetActor 去做<a class="link" target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=209047615&content_type=Article&match_order=1&q=%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B&zhida_source=entity">目标检测 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>最好能做到 Actor 复用，因为 Spawn Actor 的代价还是比较大的</p>
<h3 id="FActiveGameplayEffectHandle-蓝图引脚：Return-Value"><a href="#FActiveGameplayEffectHandle-蓝图引脚：Return-Value" class="headerlink" title="FActiveGameplayEffectHandle (蓝图引脚：Return Value)"></a>FActiveGameplayEffectHandle (蓝图引脚：Return Value)</h3><p>ApplyGameplayEffect 成功以后，ASC 会将 Apply 成功的非瞬时的 GE 放入可同步的属性 ActiveGameplayEffects（类型是： FActiveGameplayEffectsContainer）内，它的主要作用是存储和管理所有已激活 GE（以 FActiveGameplayEffect 结构体存储，它包含了FGameplayEffectSpec，生效开始时间等）</p>
<p>FActiveGameplayEffectHandle 则是用来定位 FActiveGameplayEffect 的，但它的原理和上文提到的FGameplayEffectSpecHandle 不太一样。它不是通过 TSharedPtr 去获取，而是存储了一个全局唯一的索引值（int32），通过它去 ActiveGameplayEffects 内获取 FActiveGameplayEffect 指针</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UFUNCTION</span>(BlueprintCallable)</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ApplyEffectToTarget</span><span class="params">(AActor* Target,TSubclassOf&lt;UGameplayEffect&gt; GameplayEffectClass)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">    TSubclassOf&lt;UGameplayEffect&gt; InstantGameplayEffectClass;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraEffectActor::ApplyEffectToTarget</span><span class="params">(AActor* Target, TSubclassOf&lt;UGameplayEffect&gt; GameplayEffectClass)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UAbilitySystemComponent* TargetASC= UAbilitySystemBlueprintLibrary::<span class="built_in">GetAbilitySystemComponent</span>(Target);</span><br><span class="line">    <span class="keyword">if</span> (TargetASC==<span class="literal">nullptr</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">check</span>(GameplayEffectClass);</span><br><span class="line">    FGameplayEffectContextHandle EffectContextHandle=TargetASC-&gt;<span class="built_in">MakeEffectContext</span>();</span><br><span class="line">    EffectContextHandle.<span class="built_in">AddSourceObject</span>(<span class="keyword">this</span>);</span><br><span class="line">    FGameplayEffectSpecHandle EffectSpecHandle = TargetASC-&gt;<span class="built_in">MakeOutgoingSpec</span>(GameplayEffectClass,<span class="number">1.f</span>,EffectContextHandle);</span><br><span class="line">    TargetASC-&gt;<span class="built_in">ApplyGameplayEffectSpecToSelf</span>((*EffectSpecHandle.Data.<span class="built_in">Get</span>()));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NDNhMjgyMzE1MmFmMzM0YWE0MzNiZDdhYTFiMjNlMWRfQnp6RjhkdUhvdGoxeUFPSFVRUDRZUG42eEpLSTRneHNfVG9rZW46UHg1aGJTcWF3b2g5MTd4V2pNemNaZ3ZObnBoXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>Periodic 周期效果，例如每秒回复。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NzQxN2M2MDRiYjc3NzM3MzIwYjEyYmVhYzZmYWM4MTlfck94UWNzb2toc3E1NnJMeVZBUnNtWGJFTzdsc0g4T1BfVG9rZW46SWgwaGJKc2dVb3VhR3B4YXRvZ2NjcDJGbnpoXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>初始时是否应用效果。</p>
<p>Duration 是buff，持续时间内获得效果。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDhmNmJjM2YwZDYyZjE2ZmUyNDliN2I3NjdkNGEyZGFfa0VwTmZqc1ZNUDZDcEV2UExpSU4zazVnQnhwa1Q4czZfVG9rZW46WW1rb2JJNU9Ub1ZENVR4Mk1ma2NxWGlpbjRYXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=Nzg5YWRlMzVjZjE1MzBkZTY0Y2I4Y2VkODBmNjhhMWJfbk9Db3g4akM5UHJQSzEySVp3R05aVXlyd1RrZWdMeFFfVG9rZW46RlBQa2J6NEJ1bzR5Szh4MTAwcGNJY0x6bjhiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=OWJmYTgzMWRlODg5ZWEzYmUzNTUzOGQwMDBlMzA4OGZfV2JSNXdmaDNaQ0dZYUlYSVFNSGpnWXNhOUJHNUQzWThfVG9rZW46VU45SWIxWXRqb2M3TXh4Nzl1dWNERHllbjViXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDEwNWFhMzMzMzFlYmIzZmE2ZWUwZTIxMDU5NmRjZjZfZDlmZzVPZ2RmdGZqWFRyeHVlRUtPYUFVQ21TQ1BJMEhfVG9rZW46U3RwZ2JtSXoxb1NwcGZ4bGM3T2N4dnVabjRlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>默认移除所有stack。修改其值为1，就变成了每次移除一个GE。</p>
<h2 id="18-2-场地魔法，如何实现进入收到效果，出来后解除效果。"><a href="#18-2-场地魔法，如何实现进入收到效果，出来后解除效果。" class="headerlink" title="18.2 场地魔法，如何实现进入收到效果，出来后解除效果。"></a>18.2 场地魔法，如何实现进入收到效果，出来后解除效果。</h2><p>构建overlap函数，对效果进行enum的分类处理。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UENUM</span>(BlueprintType)</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">EEffectApplicationPolicy</span>:uint8</span><br><span class="line">&#123;</span><br><span class="line">    ApplyOnOverlap,</span><br><span class="line">    ApplyOnEndOverlap,</span><br><span class="line">    DoNotApply</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">UENUM</span>(BlueprintType)</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">EEffectRemovalPolicy</span>:uint8</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    RemoveOnEndOverlap,</span><br><span class="line">    DoNotRemove</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>对GE进行默认效果设置。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line"><span class="type">bool</span> bDestroyOnEffectRemoval = <span class="literal">false</span>;</span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">TSubclassOf&lt;UGameplayEffect&gt; InstantGameplayEffectClass;</span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">EEffectApplicationPolicy InstantEffectApplicationPolicy=EEffectApplicationPolicy::DoNotApply;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">TSubclassOf&lt;UGameplayEffect&gt; DurationGameplayEffectClass;</span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">EEffectApplicationPolicy DurationEffectApplicationPolicy=EEffectApplicationPolicy::DoNotApply;</span><br><span class="line"></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">TSubclassOf&lt;UGameplayEffect&gt; InfiniteGameplayEffectClass;</span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">EEffectApplicationPolicy InfiniteEffectApplicationPolicy=EEffectApplicationPolicy::DoNotApply;</span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly,Category=<span class="string">&quot;Applied Effects&quot;</span>)</span><br><span class="line">EEffectRemovalPolicy InfiniteEffectRemovalPolicy=EEffectRemovalPolicy::DoNotRemove;</span><br></pre></td></tr></table></figure></div>

<p>根据分类apply</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraEffectActor::OnOverlap</span><span class="params">(AActor* TargetActor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(InstantEffectApplicationPolicy==EEffectApplicationPolicy::ApplyOnOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ApplyEffectToTarget</span>(TargetActor,InstantGameplayEffectClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(DurationEffectApplicationPolicy==EEffectApplicationPolicy::ApplyOnOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">ApplyEffectToTarget</span>(TargetActor,DurationGameplayEffectClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(InfiniteEffectApplicationPolicy == EEffectApplicationPolicy::ApplyOnOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">ApplyEffectToTarget</span>(TargetActor,InfiniteGameplayEffectClass);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraEffectActor::OnEndOverlap</span><span class="params">(AActor* TargetActor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(InstantEffectApplicationPolicy ==EEffectApplicationPolicy::ApplyOnEndOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">ApplyEffectToTarget</span>(TargetActor,InstantGameplayEffectClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(DurationEffectApplicationPolicy == EEffectApplicationPolicy::ApplyOnEndOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">ApplyEffectToTarget</span>(TargetActor,DurationGameplayEffectClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(InfiniteEffectApplicationPolicy == EEffectApplicationPolicy::ApplyOnEndOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">ApplyEffectToTarget</span>(TargetActor,InfiniteGameplayEffectClass);</span><br><span class="line">    &#125;</span><br><span class="line">    移除效果的写法，用键值对存，然后endoverlap的时候消除。</span><br><span class="line">    <span class="keyword">if</span>(InfiniteEffectRemovalPolicy ==EEffectRemovalPolicy::RemoveOnEndOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">       UAbilitySystemComponent* TargetASC = UAbilitySystemBlueprintLibrary    ::<span class="built_in">GetAbilitySystemComponent</span>(TargetActor);</span><br><span class="line">       <span class="keyword">if</span>(!<span class="built_in">IsValid</span>(TargetASC))<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">       TArray&lt;FActiveGameplayEffectHandle&gt; HandlesToRemove;<span class="comment">//把要remove的handle先全部存着 遍历完再一起删去。</span></span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">auto</span> HandlePair:ActiveEffectHandles)</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="keyword">if</span>(TargetASC ==HandlePair.Value)</span><br><span class="line">          &#123;</span><br><span class="line">             TargetASC-&gt; <span class="built_in">RemoveActiveGameplayEffect</span>(HandlePair.Key,<span class="number">1</span>);</span><br><span class="line">             HandlesToRemove.<span class="built_in">Add</span>(HandlePair.Key);</span><br><span class="line">             <span class="comment">//为什么可以用键值对判断指定要去除的GE，因为这个的记录方式是：主体是给GE的场景物体，然后键值对中是GE的打包体Handle和收到GE的Target，而同一时间不会有主体给同一个target其他buff，所以可以一一对应</span></span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;Handle:HandlesToRemove)</span><br><span class="line">       &#123;</span><br><span class="line">          ActiveEffectHandles.<span class="built_in">FindAndRemoveChecked</span>(Handle);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ApplyEffectToTarget的修正，主要是为了再apply的时候把GE的包Handle存入键值对中。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AAuraEffectActor::ApplyEffectToTarget</span><span class="params">(AActor* TargetActor, TSubclassOf&lt;UGameplayEffect&gt; GameplayEffectClass)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UAbilitySystemComponent* TargetASC= UAbilitySystemBlueprintLibrary::<span class="built_in">GetAbilitySystemComponent</span>(TargetActor);</span><br><span class="line">    <span class="keyword">if</span> (TargetASC==<span class="literal">nullptr</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">check</span>(GameplayEffectClass);</span><br><span class="line">    FGameplayEffectContextHandle EffectContextHandle=TargetASC-&gt;<span class="built_in">MakeEffectContext</span>();</span><br><span class="line">    EffectContextHandle.<span class="built_in">AddSourceObject</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="type">const</span> FGameplayEffectSpecHandle EffectSpecHandle = TargetASC-&gt;<span class="built_in">MakeOutgoingSpec</span>(GameplayEffectClass,<span class="number">1.f</span>,EffectContextHandle);</span><br><span class="line">    <span class="type">const</span> FActiveGameplayEffectHandle ActiveEffectHandle = TargetASC-&gt;<span class="built_in">ApplyGameplayEffectSpecToSelf</span>((*EffectSpecHandle.Data.<span class="built_in">Get</span>()));</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> bIsInfinite = EffectSpecHandle.Data.<span class="built_in">Get</span>()-&gt;Def.<span class="built_in">Get</span>()-&gt;DurationPolicy == EGameplayEffectDurationType::Infinite;</span><br><span class="line">    <span class="keyword">if</span>(bIsInfinite &amp;&amp; InfiniteEffectRemovalPolicy ==EEffectRemovalPolicy::RemoveOnEndOverlap)</span><br><span class="line">    &#123;</span><br><span class="line">       ActiveEffectHandles.<span class="built_in">Add</span>(ActiveEffectHandle,TargetASC);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="19-PreAttributeChange"><a href="#19-PreAttributeChange" class="headerlink" title="19 PreAttributeChange"></a>19 PreAttributeChange</h1><p><em>&#x2F;&#x2F;属性更改时，会自动调用这个函数进行处理</em></p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAuraAttributeSet::PreAttributeChange</span><span class="params">(<span class="type">const</span> FGameplayAttribute&amp; Attribute, <span class="type">float</span>&amp; NewValue)</span></span></span><br><span class="line"><span class="function"><span class="comment">//属性更改时，会自动调用这个函数进行处理</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">PreAttributeChange</span>(Attribute, NewValue);</span><br><span class="line">    <span class="keyword">if</span>(Attribute ==<span class="built_in">GetHealthAttribute</span>())</span><br><span class="line">    &#123;</span><br><span class="line">       NewValue = FMath::<span class="built_in">Clamp</span>(NewValue,<span class="number">0.f</span>,<span class="built_in">GetMaxHealth</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(Attribute ==<span class="built_in">GetManaAttribute</span>())</span><br><span class="line">    &#123;</span><br><span class="line">       NewValue = FMath::<span class="built_in">Clamp</span>(NewValue,<span class="number">0.f</span>,<span class="built_in">GetMaxMana</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="20-PostGameplayEffectExecute"><a href="#20-PostGameplayEffectExecute" class="headerlink" title="20 PostGameplayEffectExecute"></a>20 PostGameplayEffectExecute</h1><p>这个函数主要是用于在GE生效前存储各种数据，以此来方便后续的操作。</p>
<p>比较需要存储的数据，制作成一个STRUCT。</p>
<p>主要也就是source端的变量和target的变量。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType)</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FEffectProperties</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line">    <span class="built_in">FEffectProperties</span>()&#123;&#125;;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>()</span><br><span class="line">    FGameplayEffectContextHandle EffectContextHandle;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    UAbilitySystemComponent* SourceASC=<span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    AActor* SourceAvatarActor = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    AController* SourceController= <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    ACharacter* SourceCharacter=<span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    UAbilitySystemComponent* TargetASC=<span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    AActor* TargetAvatarActor = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    AController* TargetController= <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadWrite)</span><br><span class="line">    ACharacter* TargetCharacter=<span class="literal">nullptr</span>;</span><br><span class="line">    <span class="comment">//UPROPERTY(EditAnywhere,BlueprintReadWrite)</span></span><br><span class="line">    <span class="comment">//TObjectPtr&lt;FGameplayEffectContextHandle&gt; GameplayEffectContextHandle;</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//其中data存储了很多有用的信息，可以在GE生效前进行一些处理</span></span><br><span class="line"><span class="comment">//需要引用GameplayEffectExtension库，这是一个拓展GE的功能的库</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAuraAttributeSet::PostGameplayEffectExecute</span><span class="params">(<span class="type">const</span> FGameplayEffectModCallbackData&amp; Data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">PostGameplayEffectExecute</span>(Data);</span><br><span class="line"></span><br><span class="line">    FEffectProperties Props;</span><br><span class="line">    <span class="built_in">SetEffectProperties</span>(Data,Props);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>然后单独写一个函数来获取变量。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAuraAttributeSet::SetEffectProperties</span><span class="params">(<span class="type">const</span> FGameplayEffectModCallbackData&amp; Data, FEffectProperties Props)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Source = causer of the effect , Target = target of the effect (owner of this AS)</span></span><br><span class="line">    </span><br><span class="line">    Props.EffectContextHandle = Data.EffectSpec.<span class="built_in">GetContext</span>();</span><br><span class="line">    Props.SourceASC = Props.EffectContextHandle.<span class="built_in">GetOriginalInstigatorAbilitySystemComponent</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">IsValid</span>(Props.SourceASC) &amp;&amp; Props.SourceASC -&gt;AbilityActorInfo.<span class="built_in">IsValid</span>() &amp;&amp; Props.SourceASC -&gt;AbilityActorInfo-&gt;AvatarActor.<span class="built_in">IsValid</span>())</span><br><span class="line">    &#123;</span><br><span class="line">       Props.SourceAvatarActor = Props.SourceASC-&gt;AbilityActorInfo-&gt;AvatarActor.<span class="built_in">Get</span>();</span><br><span class="line">       Props.SourceController = Props.SourceASC-&gt;AbilityActorInfo-&gt;PlayerController.<span class="built_in">Get</span>();</span><br><span class="line">       <span class="keyword">if</span>(Props.SourceController == <span class="literal">nullptr</span> &amp;&amp; Props.SourceAvatarActor != <span class="literal">nullptr</span>)</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="type">const</span> APawn* pawn = <span class="built_in">Cast</span>&lt;APawn&gt;(Props.SourceAvatarActor))</span><br><span class="line">          &#123;</span><br><span class="line">             Props.SourceController = pawn-&gt;<span class="built_in">GetController</span>();</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(Props.SourceController)</span><br><span class="line">       &#123;</span><br><span class="line">          Props.SourceCharacter = <span class="built_in">Cast</span>&lt;ACharacter&gt;(Props.SourceController-&gt;<span class="built_in">GetPawn</span>());</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(Data.Target.AbilityActorInfo.<span class="built_in">IsValid</span>()&amp;&amp; Data.Target.AbilityActorInfo-&gt;AvatarActor.<span class="built_in">IsValid</span>())</span><br><span class="line">    &#123;</span><br><span class="line">       Props.TargetAvatarActor = Data.Target.AbilityActorInfo-&gt;AvatarActor.<span class="built_in">Get</span>();</span><br><span class="line">       Props.TargetController = Data.Target.AbilityActorInfo-&gt;PlayerController.<span class="built_in">Get</span>();</span><br><span class="line">       Props.TargetCharacter = <span class="built_in">Cast</span>&lt;ACharacter&gt;(Props.TargetAvatarActor);</span><br><span class="line">       Props.TargetASC = UAbilitySystemBlueprintLibrary::<span class="built_in">GetAbilitySystemComponent</span>(Props.TargetAvatarActor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="20-5-Curve-Tables"><a href="#20-5-Curve-Tables" class="headerlink" title="20.5 Curve Tables"></a>20.5 Curve Tables</h1><p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=YmVlMDEzM2U5MDhhMzA5Mzg0MmEyN2QzNjBmNjRhMDlfVU1EWjNKU2tYWXhxeWF4aHdsbm1HOXNORVBWNUFlZ2pfVG9rZW46VzV2WWJSY0JTb3FWRUF4dXJYaWNHVmVwbkVoXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjFlYzJhOTk4YmMxZTIzYjYzZDRjMWZjYjkzOTEyNDFfTkx2ck5wWEFJM0M3U2g2WkRGc2plYWF6ZmtTOUVrMzFfVG9rZW46S0M2R2I2QTlmbzdNMUZ4bFdhYmNEUlE5bmlkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>然后点击该键即可添加数值。 </p>
<h1 id="21Gameplay-Tags"><a href="#21Gameplay-Tags" class="headerlink" title="21Gameplay Tags"></a>21Gameplay Tags</h1><h3 id="21-0-1-规范化的添加Tags"><a href="#21-0-1-规范化的添加Tags" class="headerlink" title="21.0.1 规范化的添加Tags"></a>21.0.1 规范化的添加Tags</h3><p>制作DataTable，然后再ProjectSettings中把tags加入，也方便策划更改一些。</p>
<h3 id="21-0-2-和Stack的联动："><a href="#21-0-2-和Stack的联动：" class="headerlink" title="21.0.2 和Stack的联动："></a>21.0.2 和Stack的联动：</h3><p>一般来说，如果不开stack的话，它的buff是叠加的，然后tags的计数也会叠加，但是开了stack，它就算作是同一个buff是效果在buff内部叠加。</p>
<h2 id="21-1-Gameplay-Effect-委托的挂载"><a href="#21-1-Gameplay-Effect-委托的挂载" class="headerlink" title="21.1 Gameplay Effect 委托的挂载"></a>21.1 Gameplay Effect 委托的挂载</h2><p>GE的委托挂载会写在我们自己补充的AbilitySystemComponent里。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAurabilitySystemComponent::AbilityActorInfoSet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OnGameplayEffectAppliedDelegateToSelf.<span class="built_in">AddUObject</span>(<span class="keyword">this</span>,&amp;UAurabilitySystemComponent::EffectApplied);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAurabilitySystemComponent::EffectApplied</span><span class="params">(UAbilitySystemComponent* AbilitySystemComponent,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="type">const</span> FGameplayEffectSpec&amp; EffectSpec, FActiveGameplayEffectHandle ActiveGameplayEffectHandle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GEngine-&gt;<span class="built_in">AddOnScreenDebugMessage</span>(<span class="number">1</span>,<span class="number">8.f</span>,FColor::Blue,<span class="built_in">FString</span>(<span class="string">&quot;Effect Applied!&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></div>

<p>然后在对应的character中cast AurabilitySystemComponent，就可以set委托。</p>
<p>这样在触发GE的同时，就会调用该函数了。</p>
<h2 id="21-2-Get-All-Asset-Tags"><a href="#21-2-Get-All-Asset-Tags" class="headerlink" title="21.2 Get All Asset Tags"></a>21.2 Get All Asset Tags</h2><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAurabilitySystemComponent::EffectApplied</span><span class="params">(UAbilitySystemComponent* AbilitySystemComponent,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="type">const</span> FGameplayEffectSpec&amp; EffectSpec, FActiveGameplayEffectHandle ActiveGameplayEffectHandle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//要把信息传到HUD，计划通过tag</span></span><br><span class="line">    FGameplayTagContainer TagContainer;</span><br><span class="line">    EffectSpec.<span class="built_in">GetAllAssetTags</span>(TagContainer);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> FGameplayTag&amp; Tag: TagContainer)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="comment">//<span class="doctag">TODO:</span> Broadcast the tag to the widget controller</span></span><br><span class="line">       <span class="type">const</span> FString Msg = FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;ge tag:%s&quot;</span>),*Tag.<span class="built_in">ToString</span>());<span class="comment">//这行作用看后面</span></span><br><span class="line">       GEngine-&gt;<span class="built_in">AddOnScreenDebugMessage</span>(<span class="number">-1</span>,<span class="number">8.f</span>,FColor::Blue,Msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></div>

<p><a class="link" target="_blank" rel="noopener" href="https://z1wt6ruhl99.feishu.cn/sync/L2H1dsMais44Ilbj4lEcORHinQc">https://z1wt6ruhl99.feishu.cn/sync/L2H1dsMais44Ilbj4lEcORHinQc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="21-3-广播信息"><a href="#21-3-广播信息" class="headerlink" title="21.3 广播信息"></a>21.3 广播信息</h2><p>挂载好了委托，就需要把信息广播出去。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DECLARE_MULTICAST_DELEGATE_OneParam</span>(FEffectAssetTags<span class="comment">/*函数变量名 自己取的*/</span>,<span class="type">const</span> FGameplayTagContainer&amp; <span class="comment">/*要传播出去的变量AssetTags*/</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    FEffectAssetTags EffectAssetTags;</span><br></pre></td></tr></table></figure></div>

<p>然后在委托调用的函数里</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EffectAssetTags.<span class="built_in">Broadcast</span>(TagContainer);</span><br></pre></td></tr></table></figure></div>

<p>最后在需要接收的地方</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Cast</span>&lt;UAurabilitySystemComponent&gt;(AbilitySystemComponent)-&gt;EffectAssetTags.<span class="built_in">AddLambda</span>(</span><br><span class="line"> [](<span class="type">const</span> FGameplayTagContainer&amp; AssetTags)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">const</span> FGameplayTag&amp; Tag: AssetTags)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">const</span> FString Msg = FString::<span class="built_in">Printf</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;ge tag:%s&quot;</span>),*Tag.<span class="built_in">ToString</span>());</span><br><span class="line">    GEngine-&gt;<span class="built_in">AddOnScreenDebugMessage</span>(<span class="number">-1</span>,<span class="number">8.f</span>,FColor::Blue,Msg);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>

<p>这个是一个匿名函数的写法。主要是一个cast的细节。</p>
<h2 id="21-4-UI-Widget-DataTable"><a href="#21-4-UI-Widget-DataTable" class="headerlink" title="21.4 UI Widget DataTable"></a>21.4 UI Widget DataTable</h2><p>因为我们只传一个tag，如果其他的一起传输性能可能会变得很差，所以选择建立一个表把tag相关联的变量存进去，然后需要什么东西就以tag位索引取调用即可。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">USTRUCT</span>(BlueprintType)</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FUIWidgetRow</span>: <span class="keyword">public</span> FTableRowBase</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly)</span><br><span class="line">    FGameplayTag MessageTag = <span class="built_in">FGameplayTag</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly)</span><br><span class="line">    FText Message = <span class="built_in">FText</span>();</span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly)</span><br><span class="line">    TSubclassOf&lt;UAuraUserWidget&gt; MessageWidget;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere,BlueprintReadOnly)</span><br><span class="line">    UTexture2D* Image = <span class="literal">nullptr</span>;<span class="comment">//可选变量，因为赋予了默认的初值。</span></span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>然后就可以在蓝图里创建列表了。</p>
<p>然后我们要怎么用tag去索引找到对应的row呢？</p>
<p>先搞一个模板函数</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="comment">//表示可以返回任意值,这个函数的用处是，通过tag找到对应行，然后返回对应行</span></span><br><span class="line"><span class="function">T* <span class="title">GetDataTableRowByTag</span><span class="params">(UDataTable* DataTable,<span class="type">const</span> FGameplayTag&amp; Tag)</span></span>;<span class="comment">//模板函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T* <span class="title">UOverlayWidgetController::GetDataTableRowByTag</span><span class="params">(UDataTable* DataTable, <span class="type">const</span> FGameplayTag&amp; Tag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  DataTable-&gt;<span class="built_in">FindRow</span>&lt;T&gt;(Tag.<span class="built_in">GetTagName</span>(),<span class="built_in">TEXT</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>代码解释如下：</p>
<ul>
<li><code>DataTable</code> 是一个指向 <code>UDataTable</code> 类型的指针，<code>UDataTable</code> 是Unreal Engine中用于存储结构化数据的类。</li>
<li><code>FindRow&lt;T&gt;</code> 是 <code>UDataTable</code> 类的一个模板函数，用于查找数据表中具有特定标签的行。这里的 <code>T</code> 表示行的数据类型。</li>
<li><code>Tag.GetTagName()</code> 调用 <code>Tag</code> 对象的 <code>GetTagName</code> 方法来获取一个标签名，这个标签名用于在数据表中查找对应的行。</li>
<li><code>TEXT(&quot;&quot;)</code> 是一个宏，用于确保字符串字面量在不同平台（如Windows和Mac）上正确处理Unicode字符。在这个上下文中，它看起来像是一个占位符，但实际上并没有提供任何字符串值。</li>
</ul>
<p>这行代码的作用是：在 <code>DataTable</code> 中查找一个标签名为 <code>Tag.GetTagName()</code> 返回值的行。如果找到了，它将返回一个指向该行的指针；如果没有找到，它将返回 <code>nullptr</code>。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FUIWidgetRow* Row= <span class="built_in">GetDataTableRowByTag</span>&lt;FUIWidgetRow&gt;(MessageWidgetDataTable,Tag);   </span><br></pre></td></tr></table></figure></div>

<h2 id="21-5-Broadcasting-datatable-row"><a href="#21-5-Broadcasting-datatable-row" class="headerlink" title="21.5 Broadcasting datatable row"></a>21.5 Broadcasting datatable row</h2><p>和前面的广播基本一样</p>
<h2 id="21-6-MessageWidget"><a href="#21-6-MessageWidget" class="headerlink" title="21.6 MessageWidget"></a>21.6 MessageWidget</h2><p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NDY5Y2ZmNDA3YjFmMjBhY2IzYTVlZWRhNTFhYjI1YzBfdG5PUFE5Tm9tZDhlZEwyajNSSnVMNWVuREFIc2ZlaFpfVG9rZW46U0wySWJsVHBrb21ma3Z4VFE3UGNZNGNhblNiXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>主要是这四个 ，spacer是在图片和文字中控制间隔的。</p>
<p>为了泛用性在其中写个蓝图函数更改icon和message</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTU1NzZhOTk4MmM3OGRhZjI3NTc0YzA4N2VkZTIwZjRfWkc4Unk5cGRYTk1KM0s0VzNpQmdVS0E2VDVneEhNak1fVG9rZW46VnlvaWJjaTJSb0V2VmZ4cVNvcmNHV0pxbmRjXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>因为我们需要最后贴上去的图片是统一大小的，所以创建一个变量来赋值。</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=NjU4YmZmM2RmODJiYjI3NDE2ODIxNjI5MGIyYzE3ZjFfUUw1cm1lUExkdkZBUUczOENVNWN1aWxqak5EdHlPbDhfVG9rZW46R1Qza2JLcHhJb0tCOVp4T3pLcGMwU0IybmlmXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>委托调用点来触发widget显示，比较不会的点是Set Position in Viewport，还有就是cast to 对应更详细的类，以此来调用函数的做法，老是会忘记这个。</p>
<p>结果在屏幕上显示的尺寸有问题，解决方法是：</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MjYyMWNmNTM2NWZhNDJlZmQ3ZjJjNTY3OGZkOGU3NzFfYnNtbXJOSGlrWVN4ZUMxeUQxNnZZQ3R4amFSbEpwN0FfVG9rZW46WEFUN2JxYnk3bzZqVkd4bEpHamM5aVJFbnZnXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<h2 id="21-7-Animating-message-widget"><a href="#21-7-Animating-message-widget" class="headerlink" title="21.7 Animating message widget"></a>21.7 Animating message widget</h2><p>大体类似于unity的animation。</p>
<h2 id="21-7-5-用匿名函数简化代码"><a href="#21-7-5-用匿名函数简化代码" class="headerlink" title="21.7.5 用匿名函数简化代码"></a>21.7.5 用匿名函数简化代码</h2><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AbilitySystemComponent-&gt;<span class="built_in">GetGameplayAttributeValueChangeDelegate</span>(</span><br><span class="line"> AuraAttributeSet-&gt;<span class="built_in">GetManaAttribute</span>()).<span class="built_in">AddUObject</span>(<span class="keyword">this</span>,&amp;UOverlayWidgetController::ManaChanged);</span><br></pre></td></tr></table></figure></div>

<p>原本代码中用的是属性值更改时触发回调函数，现在改成直接触发匿名函数。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AbilitySystemComponent-&gt;<span class="built_in">GetGameplayAttributeValueChangeDelegate</span>(</span><br><span class="line">AuraAttributeSet-&gt;<span class="built_in">GetManaAttribute</span>()).<span class="built_in">AddLambda</span>(</span><br><span class="line"> [<span class="keyword">this</span>](<span class="type">const</span> FOnAttributeChangeData&amp; Data)</span><br><span class="line">&#123;</span><br><span class="line">  OnManaChanged.<span class="built_in">Broadcast</span>(Data.NewValue);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<p>这样代码更简洁，</p>
<p>然后在建立委托处，相似的委托直接用一个事件即可。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(FOnAttributeChangedSignature,<span class="type">float</span>,NewValue);</span><br></pre></td></tr></table></figure></div>

<h2 id="21-8-用data-table来初始化数据"><a href="#21-8-用data-table来初始化数据" class="headerlink" title="21.8 用data table来初始化数据"></a>21.8 用data table来初始化数据</h2><p>在playerstate中把abilitysystem设置为蓝图可视化，然后在蓝图中配表，</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MDAzYTNjNTQ0MjJjNGQ4MDE2YTllNjZkMmI3YTUxZTRfTjJmQVVmZ3Z2aTJnRURnSUFlSm1wRjNmTjhkeVVtNThfVG9rZW46S04zMmJ6dm1Ub1pVZjB4bkRCWWNVM3VZbjZkXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>其中row Name需要以</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWU2NmFhZmQ0Y2U4YzkyOTIxZjhjMGZiOTE2ZmRiOGVfZVJOejNDRnpyMEVVc3Q2OHFpak1mSjVWbnA1eXAyakRfVG9rZW46U2wySGI4ODdUb0ZwVjF4aUtpd2NXbzl6blBZXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>的形式来写，要与属性一一对应。</p>
<h1 id="22-Ghost-Globe"><a href="#22-Ghost-Globe" class="headerlink" title="22 Ghost Globe"></a>22 Ghost Globe</h1><p>就是血量值后面有个残影延迟跟着，个人认为的主要难点是在于延迟跟随的做法。</p>
<p>先搞一个target值，然后在tick中可以直接interp 插值 然后设置百分比值就可以了</p>
<p><img lazyload src="/images/loading.svg" data-src="https://z1wt6ruhl99.feishu.cn/space/api/box/stream/download/asynccode/?code=MmJiZjlmNzRiNzJlODczZGUzMjQyMDI2YjAxMDMzZjhfa2tjOG1wMnY2MktnVllnWGJKYmVWZVBKc1hLVldUSU9fVG9rZW46U1BoTGJXdlNTb1huQkd4aUd3WWNFUWJabjdlXzE3Mjk5MjE5ODQ6MTcyOTkyNTU4NF9WNA" alt="img"></p>
<p>之前考虑的时候感觉还得记录初始值比较麻烦，但是其实不用，因为插值是匀速增加的，可以直接拿实时的值来对每一帧进行插值计算。</p>

        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> GAS学习记录第一季</li>
        <li><strong>Author:</strong> 沐云白</li>
        <li><strong>Created at
                :</strong> 2024-10-26 13:53:14</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-10-26 13:58:09
            </li>
        
        <li>
            <strong>Link:</strong> https://redefine.ohevan.com/2024/10/26/GAS-learn2/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/10/26/GAS-learn1/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">GAS学习记录第一季</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">GAS学习记录第一季</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text">0 基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%86%99%E8%93%9D%E5%9B%BE%E3%80%81%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%86%99c"><span class="nav-text">什么时候写蓝图、什么时候写c++</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%BB%BA%E7%AB%8B%E7%8E%A9%E5%AE%B6%E5%92%8C%E6%95%8C%E4%BA%BA%E7%9A%84%E5%9F%BA%E7%B1%BB"><span class="nav-text">1 建立玩家和敌人的基类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E9%85%8D%E7%BD%AE%E6%AD%A6%E5%99%A8%E4%BB%A5%E5%8F%8A%E6%8C%82%E7%82%B9"><span class="nav-text">2 配置武器以及挂点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E5%9C%A8c-%E4%B8%AD%E9%85%8D%E7%BD%AE%E6%AD%A6%E5%99%A8"><span class="nav-text">2.1 在c++中配置武器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E5%88%9B%E5%BB%BA%E5%8A%A8%E7%94%BB"><span class="nav-text">3 创建动画</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E4%B8%BB%E8%A7%92%E5%8A%A8%E7%94%BB"><span class="nav-text">3.1 主角动画</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E6%80%AA%E7%89%A9%E7%9A%84%E5%8A%A8%E7%94%BB"><span class="nav-text">3.2 怪物的动画</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E5%A2%9E%E5%BC%BA%E8%BE%93%E5%85%A5%E4%B8%8E%E5%9D%90%E6%A0%87%E8%BD%B4"><span class="nav-text">4 增强输入与坐标轴</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E9%85%8D%E7%BD%AE%E6%8C%89%E9%94%AE%E6%98%A0%E5%B0%84%E6%83%85%E6%99%AF"><span class="nav-text">5 配置按键映射情景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E7%BC%96%E5%86%99%E7%BB%91%E5%AE%9A%E5%87%BD%E6%95%B0"><span class="nav-text">6 编写绑定函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-%E8%AE%BE%E7%BD%AEGM%E4%BD%BF%E7%8E%A9%E5%AE%B6%E5%8A%A8%E8%B5%B7%E6%9D%A5"><span class="nav-text">7 设置GM使玩家动起来</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-%E7%BC%96%E5%86%99%E6%B2%9F%E8%BE%B9"><span class="nav-text">8 编写沟边</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-%E5%88%9B%E5%BB%BAGAS"><span class="nav-text">9 创建GAS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E6%97%B6%E6%9C%BA%EF%BC%9A"><span class="nav-text">9.1 初始化的时机：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88Player%E7%9A%84OwnerActor%E6%98%AFPlayerState%EF%BC%8CAvatarActor%E6%98%AFCharacter%EF%BC%9A"><span class="nav-text">为什么Player的OwnerActor是PlayerState，AvatarActor是Character：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-SetAttribute"><span class="nav-text">10 SetAttribute</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-%E8%AE%BE%E7%BD%AE%E3%80%81%E8%8E%B7%E5%8F%96-%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="nav-text">11 设置、获取 属性值</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AAactor%E5%8F%AF%E4%BB%A5%E8%A7%A6%E5%8F%91GameEffect"><span class="nav-text">12 制作一个actor可以触发GameEffect</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AAGlobeProgressBar%E7%9A%84%E5%9F%BA%E7%B1%BB"><span class="nav-text">13 制作一个GlobeProgressBar的基类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#14-HUD-%E8%AE%BE%E7%BD%AE"><span class="nav-text">14 HUD  设置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#15-Overlay-Widget-Controller"><span class="nav-text">15 Overlay Widget Controller</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#16-Broadcast-Initial-Values"><span class="nav-text">16 Broadcast Initial Values</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#17-Listening-for-attribute-Change"><span class="nav-text">17 Listening for attribute Change</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#18-%E9%87%8D%E6%96%B0%E6%9E%84%E5%BB%BAEffectActor"><span class="nav-text">18 重新构建EffectActor</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#18-1-%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AF%86%EF%BC%9A"><span class="nav-text">18.1 前提知识：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FGameplayEffectSpec-%E8%93%9D%E5%9B%BE%E5%BC%95%E8%84%9A%EF%BC%9AEffect-Spec-Handle-Spec-Handle"><span class="nav-text">FGameplayEffectSpec (蓝图引脚：Effect Spec Handle &#x2F; Spec Handle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FGameplayEffectContext-%E8%93%9D%E5%9B%BE%E5%BC%95%E8%84%9A%EF%BC%9AEffect-Context-Context"><span class="nav-text">FGameplayEffectContext (蓝图引脚：Effect Context &#x2F; Context)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FGameplayAbilityTargetData-%E8%93%9D%E5%9B%BE%E5%BC%95%E8%84%9A%EF%BC%9ATarget-Data"><span class="nav-text">FGameplayAbilityTargetData (蓝图引脚：Target Data)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FActiveGameplayEffectHandle-%E8%93%9D%E5%9B%BE%E5%BC%95%E8%84%9A%EF%BC%9AReturn-Value"><span class="nav-text">FActiveGameplayEffectHandle (蓝图引脚：Return Value)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-2-%E5%9C%BA%E5%9C%B0%E9%AD%94%E6%B3%95%EF%BC%8C%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%BF%9B%E5%85%A5%E6%94%B6%E5%88%B0%E6%95%88%E6%9E%9C%EF%BC%8C%E5%87%BA%E6%9D%A5%E5%90%8E%E8%A7%A3%E9%99%A4%E6%95%88%E6%9E%9C%E3%80%82"><span class="nav-text">18.2 场地魔法，如何实现进入收到效果，出来后解除效果。</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#19-PreAttributeChange"><span class="nav-text">19 PreAttributeChange</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#20-PostGameplayEffectExecute"><span class="nav-text">20 PostGameplayEffectExecute</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#20-5-Curve-Tables"><span class="nav-text">20.5 Curve Tables</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#21Gameplay-Tags"><span class="nav-text">21Gameplay Tags</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#21-0-1-%E8%A7%84%E8%8C%83%E5%8C%96%E7%9A%84%E6%B7%BB%E5%8A%A0Tags"><span class="nav-text">21.0.1 规范化的添加Tags</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-0-2-%E5%92%8CStack%E7%9A%84%E8%81%94%E5%8A%A8%EF%BC%9A"><span class="nav-text">21.0.2 和Stack的联动：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-1-Gameplay-Effect-%E5%A7%94%E6%89%98%E7%9A%84%E6%8C%82%E8%BD%BD"><span class="nav-text">21.1 Gameplay Effect 委托的挂载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-2-Get-All-Asset-Tags"><span class="nav-text">21.2 Get All Asset Tags</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-3-%E5%B9%BF%E6%92%AD%E4%BF%A1%E6%81%AF"><span class="nav-text">21.3 广播信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-4-UI-Widget-DataTable"><span class="nav-text">21.4 UI Widget DataTable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-5-Broadcasting-datatable-row"><span class="nav-text">21.5 Broadcasting datatable row</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-6-MessageWidget"><span class="nav-text">21.6 MessageWidget</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-7-Animating-message-widget"><span class="nav-text">21.7 Animating message widget</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-7-5-%E7%94%A8%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0%E7%AE%80%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="nav-text">21.7.5 用匿名函数简化代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-8-%E7%94%A8data-table%E6%9D%A5%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="nav-text">21.8 用data table来初始化数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#22-Ghost-Globe"><span class="nav-text">22 Ghost Globe</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">沐云白</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        4 posts in total
                    </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.7.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>








    
<script src="/js/libs/anime.min.js"></script>





    
<script src="/js/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/layouts/essays.js" type="module" data-swup-reload-script=""></script>




</body>
</html>
